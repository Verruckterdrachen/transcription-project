# 🎙️ Инструкция для AI Assistant: Транскрибация интервью 3.0

## 📋 ОБЩАЯ ИНФОРМАЦИЯ

**Репозиторий:** https://github.com/Verruckterdrachen/transcription-project

**Назначение:**
Автоматическая транскрибация аудио-интервью историков для производства документальных военных фильмов. Проект обрабатывает многочасовые интервью с разделением спикеров (Журналист, Эксперт, Оператор) и выводом текста с таймкодами.

**Технологический стек:**
- Python 3.10+
- OpenAI Whisper (large-v3-turbo) - транскрибация
- Pyannote Audio 3.1 - диаризация (разделение спикеров)
- PyTorch + CUDA - GPU ускорение
- FFmpeg - обработка аудио

**Язык:** Русский (военные термины, имена, исторические события)

---

## 🔄 АЛГОРИТМ РАБОТЫ ЧЕРЕЗ GITHUB

### 1️⃣ Получение контекста проекта

При каждом новом запросе в Space выполняй следующие шаги:

**Шаг 1: Проверка текущей версии**
```
Читай: doc/CURRENT_VERSION.md
```
Этот файл содержит:
- Номер текущей версии
- Список последних изменений
- Известные проблемы
- Статус стабильности

**Шаг 2: Понимание архитектуры**
```
Читай: doc/ARCHITECTURE.md
```
Этот файл содержит:
- Структуру проекта
- Описание модулей
- Pipeline обработки (9 этапов)
- Зависимости между модулями

**Шаг 3: История версий (при необходимости)**
```
Читай: doc/VERSION_HISTORY.md
```
Используй при:
- Необходимости понять эволюцию функционала
- Откате к предыдущей версии
- Анализе исправленных багов

### 2️⃣ Работа с кодом

**Получение файлов:**
Используй GitHub MCP tools для чтения файлов:
```
mcp_tool_github-mcp-direct_get_file_contents
owner: Verruckterdrachen
repo: transcription-project
path: scripts/transcribe_v16.py (или другой путь)
```

**Проверка модулей:**
- `scripts/core/` - базовые модули
- `scripts/corrections/` - исправления и коррекции
- `scripts/merge/` - слияние и валидация
- `scripts/export/` - экспорт данных

**Создание изменений:**
- Всегда создавай новую версию файла (например, transcribe_v17.py)
- Используй осмысленные commit messages
- Обновляй doc/CURRENT_VERSION.md при создании новой версии

### 3️⃣ Workflow для разработки

```
┌─────────────────────────────────────────┐
│ 1. Получение задачи от пользователя    │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│ 2. Чтение doc/CURRENT_VERSION.md        │
│    и doc/ARCHITECTURE.md                │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│ 3. Получение необходимых файлов         │
│    через GitHub MCP                     │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│ 4. Анализ кода и диагностика проблемы   │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│ 5. Разработка решения                   │
│    - Проверка типов возвращаемых        │
│      значений                           │
│    - Проверка имён параметров           │
│    - Проверка импортов                  │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│ 6. Создание новой версии файла          │
│    (например, v16.5 → v16.6)            │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│ 7. Обновление doc/CURRENT_VERSION.md    │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│ 8. Commit изменений с описанием         │
└─────────────────────────────────────────┘
```

---

## 📚 СТРУКТУРА ДОКУМЕНТАЦИИ

### Обязательные файлы для чтения:

1. **`doc/CURRENT_VERSION.md`** ⭐ ЧИТАЙ ВСЕГДА
   - Текущая версия проекта
   - Последние изменения
   - Известные проблемы
   
2. **`doc/ARCHITECTURE.md`** ⭐ ЧИТАЙ ПРИ РАБОТЕ С КОДОМ
   - Структура проекта
   - Описание модулей
   - Pipeline обработки

3. **`doc/VERSION_HISTORY.md`** 📖 ЧИТАЙ ПО НЕОБХОДИМОСТИ
   - Полная история версий
   - Детальное описание изменений

4. **`README.md`** 📄 ОБЗОРНАЯ ИНФОРМАЦИЯ
   - Быстрый старт
   - Основные возможности

### Файлы с примерами:

- `doc/examples_speakers/` - примеры обработки интервью
- `doc/test/` - тестовые данные

---

## 🛠️ ПРИНЦИПЫ РАЗРАБОТКИ

### ✅ ОБЯЗАТЕЛЬНО:

1. **Version Control**
   - Каждое изменение = новая версия файла
   - Формат: `transcribe_v{major}.{minor}.py`
   - Комментарии с версией: `# 🆕 v16.6: описание изменения`

2. **Проверка перед изменениями**
   - Читай `doc/CURRENT_VERSION.md` для понимания текущего состояния
   - Читай `doc/ARCHITECTURE.md` для понимания зависимостей
   - Проверяй затронутые модули через GitHub MCP

3. **Тестирование логики**
   - Проверяй типы возвращаемых значений (list vs int vs dict)
   - Проверяй соответствие имён параметров
   - Проверяй наличие всех импортов

4. **Документирование**
   - Обновляй `doc/CURRENT_VERSION.md` при создании новой версии
   - Добавляй запись в `doc/VERSION_HISTORY.md` для мажорных изменений
   - Используй emoji в комментариях кода: 🔧✅⚠️🆕

### ❌ ЗАПРЕЩЕНО:

1. **НЕ изменяй core logic** без явного запроса
2. **НЕ удаляй функции** без проверки зависимостей
3. **НЕ генерируй код** без проверки на ошибки
4. **НЕ делай breaking changes** без версионирования
5. **НЕ работай без чтения** `doc/CURRENT_VERSION.md`

---

## 🔍 ДИАГНОСТИКА ПРОБЛЕМ

### Алгоритм диагностики:

1. **Получи traceback** от пользователя
2. **Найди источник ошибки:**
   - Используй GitHub MCP для чтения файла с ошибкой
   - Проанализируй вызов функции
3. **Проверь типы данных:**
   - Что функция возвращает (list/int/dict)?
   - Что ожидает вызывающий код?
4. **Проверь параметры:**
   - Соответствуют ли имена параметров?
   - Все ли обязательные параметры переданы?
5. **Проверь импорты:**
   - Все ли модули импортированы?
   - Правильные ли пути импорта?

### Типичные ошибки:

```python
# ❌ ОШИБКА: Функция возвращает int вместо list
def process_segments(segments):
    return len(segments)  # ❌ Возвращает int
    
# ✅ ПРАВИЛЬНО:
def process_segments(segments):
    return segments  # ✅ Возвращает list

# ❌ ОШИБКА: Несоответствие имён параметров
result = align_segments(
    segments=data,
    speaker="Исаев"  # ❌ Параметр называется speaker_surname
)

# ✅ ПРАВИЛЬНО:
result = align_segments(
    segments=data,
    speaker_surname="Исаев"  # ✅ Правильное имя
)
```

---

## 🎯 ПРИОРИТЕТЫ ОПТИМИЗАЦИИ

### A) Accuracy (Точность):
- Минимизация ошибок speaker attribution
- Улучшение boundary detection
- Фильтрация галлюцинаций Whisper

### B) Performance (Производительность):
- GPU utilization (RTX 3070)
- Batch processing для длинных файлов
- Кэширование промежуточных результатов

### C) Maintainability (Поддержка):
- Модульная архитектура
- Четкие имена функций и переменных
- Логирование критических операций

---

## 📞 ВЗАИМОДЕЙСТВИЕ С ПОЛЬЗОВАТЕЛЕМ

### При получении задачи:

1. **Подтверди понимание:**
   ```
   ✅ Понял задачу: [описание]
   📂 Затронутые файлы: [список]
   🔍 Текущая версия: v16.5
   ```

2. **Запроси недостающую информацию:**
   - Traceback ошибки
   - Версия файла (если неясно)
   - Ожидаемое поведение

3. **Предупреди о рисках:**
   - Если изменение затрагивает core logic
   - Если нужен breaking change
   - Если требуется тестирование на реальных данных

### При создании решения:

1. **Объясни логику изменений**
2. **Покажи diff (что изменилось)**
3. **Укажи новую версию**
4. **Предложи план тестирования**

---

## 🚀 БЫСТРЫЙ СТАРТ

### Для нового запроса в Space:

```bash
# 1. Прочитай текущую версию
GET doc/CURRENT_VERSION.md

# 2. Прочитай архитектуру (если работа с кодом)
GET doc/ARCHITECTURE.md

# 3. Получи нужные файлы
GET scripts/transcribe_v16.py
GET scripts/core/[нужный_модуль].py

# 4. Работай с кодом
# 5. Создай новую версию
# 6. Обновляй документацию
```

---

## 📝 ШАБЛОН ДЛЯ COMMIT MESSAGE

```
<тип>: <краткое описание>

<детальное описание изменений>

Версия: v16.X → v16.Y
Модули: [список затронутых модулей]
Fixes: #<номер issue> (если применимо)
```

**Типы:**
- `feat:` - новая функциональность
- `fix:` - исправление бага
- `refactor:` - рефакторинг без изменения поведения
- `docs:` - обновление документации
- `test:` - добавление тестов
- `perf:` - улучшение производительности

---

## ✨ ЗАКЛЮЧЕНИЕ

**Ключевые правила:**

1. ⭐ **ВСЕГДА читай `doc/CURRENT_VERSION.md` в начале работы**
2. 📚 **Используй GitHub MCP для получения файлов**
3. 🔄 **Создавай новую версию при изменениях**
4. 📝 **Обновляй документацию**
5. ✅ **Проверяй код перед отправкой**

**Помни:** Проект работает с реальными интервью для документальных фильмов. Точность транскрибации критична для качества финального продукта.

---

*Последнее обновление: 11.02.2026*
