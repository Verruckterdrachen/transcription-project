# üêõ DEBUGGING.md ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Ç–ª–∞–¥–∫–∏ v16.28

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏—Å–∫–∞—Ç—å –∏ —É—Å—Ç—Ä–∞–Ω—è—Ç—å –±–∞–≥–∏ –≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–æ–Ω–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ v16.x.

–û—Å–Ω–æ–≤–Ω–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è:

- **Real tests > Integration > Unit**
- **Debug output + 5 Whys ‚Üí ROOT CAUSE ‚Üí FIX ‚Üí Real test**
- Unit tests ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç (regex, –ø–∞—Ä—Å–∏–Ω–≥, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## 1. –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ç–ª–∞–¥–∫–∏

1. **Documentation First**  
   –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∫–æ–¥–∞:
   - –ø—Ä–æ—á–∏—Ç–∞–π `VERSION.md` (–ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è, –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –±–∞–≥–∏ –∏ —Ñ–∏–∫—Å—ã);
   - –∑–∞–≥–ª—è–Ω–∏ –≤ `ARCHITECTURE.md` (–≥–¥–µ –∏–º–µ–Ω–Ω–æ –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ —Ç–≤–æ–π —ç—Ç–∞–ø).

2. **GitHub as Source**  
   –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã.

3. **Debug First, Fix Later**  
   –ü–µ—Ä–µ–¥ –ª—é–±—ã–º —Ñ–∏–∫—Å–æ–º:
   - –≤–∫–ª—é—á–∏/–¥–æ–±–∞–≤—å debug‚Äë–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ;
   - —É–±–µ–¥–∏—Å—å, —á—Ç–æ –º–æ–∂–µ—à—å —É–≤–∏–¥–µ—Ç—å –±–∞–≥ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤/timestamp‚Äô–æ–≤.

4. **Root Cause Analysis (5 Whys)**  
   –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è –Ω–∞ —Å–∏–º–ø—Ç–æ–º–µ:
   - 5 —Ä–∞–∑ —Å–ø—Ä–æ—Å–∏ ¬´–ø–æ—á–µ–º—É?¬ª –¥–æ –Ω–∞—Å—Ç–æ—è—â–µ–π –ø—Ä–∏—á–∏–Ω—ã;
   - –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π ROOT CAUSE –≤ `VERSION.md`.

5. **Real test –ü–ï–†–ï–î –∫–æ–º–º–∏—Ç–æ–º**  
   –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
   - –∑–∞–ø—É—Å—Ç–∏ `python scripts/transcribe.py` –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –∞—É–¥–∏–æ;
   - –ø—Ä–æ–≤–µ—Ä—å 7 –ø—É–Ω–∫—Ç–æ–≤ –∏–∑ `VALIDATION.md`.

---

## 2. –ê–ª–≥–æ—Ä–∏—Ç–º –æ—Ç–ª–∞–¥–∫–∏ (pipeline‚Äë–±–∞–≥)

1. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π **—Å–∏–º–ø—Ç–æ–º** (—á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ç–∞–∫ –≤ TXT/JSON):
   - –ø—Ä–æ–ø–∞–ª–∞ —Ñ—Ä–∞–∑–∞;
   - –Ω–µ–≤–µ—Ä–Ω—ã–π —Å–ø–∏–∫–µ—Ä;
   - –¥—É–±–ª–∏ timestamps;
   - —Å—Ç—Ä–∞–Ω–Ω—ã–µ –ø–∞—É–∑—ã –∏ —Ç.–ø.

2. –û–ø—Ä–µ–¥–µ–ª–∏ **–≥–¥–µ –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ** –º–æ–≥ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —ç—Ñ—Ñ–µ–∫—Ç:
   - —Å–º–æ—Ç—Ä–∏ `ARCHITECTURE.md` ‚Äî —ç—Ç–∞–ø—ã 1‚Äì10;
   - –Ω–∞–π–¥–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç `seg['text']`, `start`, `end`.

3. –í–∫–ª—é—á–∏/–¥–æ–±–∞–≤—å **debug checkpoints** (—Å–º. –Ω–∏–∂–µ).

4. –°—Ä–∞–≤–Ω–∏ **checkpoint ‚Äú–î–û‚Äù –∏ ‚Äú–ü–û–°–õ–ï‚Äù**:
   - –∏—â–∏, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –∏–∑–º–µ–Ω–∏–ª—Å—è —Ç–µ–∫—Å—Ç/—Å–ø–∏–∫–µ—Ä/timestamp;
   - –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π —Ç–æ—á–Ω—ã–π —ç—Ç–∞–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–≠—Ç–∞–ø 6.1 ‚Äî Timestamp Injection¬ª).

5. –ü—Ä–æ—á–∏—Ç–∞–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–π —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞:
   - –Ω–∞–π–¥–∏ –º–µ—Å—Ç–æ, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ä—Ç—è—Ç—Å—è;
   - —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π ROOT CAUSE —á–µ—Ä–µ–∑ 5 Whys.

6. –ü—Ä–∏–¥—É–º–∞–π –∏ —Ä–µ–∞–ª–∏–∑—É–π FIX:
   - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ –æ–±—ä—ë–º—É;
   - –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –Ω–∞ —Å–æ—Å–µ–¥–Ω–∏–µ —ç—Ç–∞–ø—ã.

7. –ó–∞–ø—É—Å—Ç–∏ **Real test**:
   - –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–≤—å—é;
   - —Å –ø–æ–ª–Ω—ã–º –ø–∞–π–ø–ª–∞–π–Ω–æ–º, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–µ–π.

8. –û–±–Ω–æ–≤–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:
   - `VERSION.md` ‚Äî –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è + ROOT CAUSE + FIX;
   - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî `DEBUGGING.md`, `ARCHITECTURE.md`, `TESTING-STRATEGY.md`.

---

## 3. Debug output

### 3.1. –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞

- –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã:
  - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è (—Å–ª–∏—è–Ω–∏–µ, —Ä–∞–∑–±–∏–µ–Ω–∏–µ, —Å–º–µ–Ω–∞ —Å–ø–∏–∫–µ—Ä–∞);
  - —Å–æ–¥–µ—Ä–∂–∞—Ç—å timestamp, speaker, –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞.
- –ù–µ —Å–ø–∞–º–∏—Ç—å –≤—Å–µ–º –ø–æ–¥—Ä—è–¥ ‚Äî –ª–æ–≥–∏—Ä—É–π —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –º–µ—Å—Ç–∞.

### 3.2. –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–µ–∑–Ω–æ–≥–æ debug‚Äë–≤—ã–≤–æ–¥–∞

**Merge —Ä–µ–ø–ª–∏–∫:**

```python
print(f"üîó MERGE {i} + {j} ‚Üí [{merged['time']}] "
      f"{merged['speaker']} ({len(merged['text'].split())} —Å–ª–æ–≤)")
Split mixed‚Äëspeaker —Å–µ–≥–º–µ–Ω—Ç–∞:

python
print(f"‚úÇÔ∏è SPLIT [{seg['time']}] {seg['speaker']} ‚Üí "
      f"{len(new_segments)} —á–∞—Å—Ç–µ–π")
Hallucination filter:

python
print(f"üßπ HALLUCINATION REMOVE: [{seg['time']}] "
      f"{seg['speaker']} ‚Üí '{seg['text'][:80]}...'")
4. Debug checkpoints (v16.28+)
–£—Ä–æ–∫ –ë–ê–ì #3:
–ü–æ–ª–æ–≤–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ —É—à–ª–∞ –Ω–∞ —Ç–æ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Ç–µ–∫—Å—Ç –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –Ω–∞ —ç—Ç–∞–ø–µ insert_intermediate_timestamps() ‚Äî –¥–æ —ç—Ç–æ–≥–æ –Ω–µ –±—ã–ª–æ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö checkpoint‚Äô–æ–≤.

4.1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è checkpoint‚Äô–∞
python
from core.utils import seconds_to_hms

def debug_checkpoint(segments, stage_name, target_timestamps=None):
    """
    v16.28: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π checkpoint –¥–ª—è –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –ø–∞–π–ø–ª–∞–π–Ω–∞.

    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ segments –Ω–∞ —ç—Ç–∞–ø–µ stage_name.
    –ü–æ–º–æ–≥–∞–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å, –≥–¥–µ –ø—Ä–æ–ø–∞–ª —Ç–µ–∫—Å—Ç/—Ñ—Ä–∞–∑–∞/—Å–ø–∏–∫–µ—Ä.

    Args:
        segments: —Å–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
        stage_name: –∏–º—è —ç—Ç–∞–ø–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "AFTER MERGE")
        target_timestamps: —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö HH:MM:SS –¥–ª—è —Ü–µ–ª–µ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
    """
    if target_timestamps is None:
        target_timestamps = []

    print(f"\nüîç CHECKPOINT [{stage_name}]: {len(segments)} —Å–µ–≥–º–µ–Ω—Ç–æ–≤")

    for target_ts in target_timestamps:
        found = False
        for seg in segments:
            seg_start = seconds_to_hms(seg["start"])
            seg_end = seconds_to_hms(seg["end"])

            if seg_start <= target_ts <= seg_end or seg_start == target_ts:
                found = True
                text = seg.get("text", "")
                duration = seg["end"] - seg["start"]

                print(f"   ‚úÖ {target_ts}: –ù–ê–ô–î–ï–ù –≤ [{seg_start}-{seg_end}] "
                      f"(–¥–ª–∏—Ç={duration:.1f}s, —Å–ª–æ–≤={len(text.split())})")

                if len(text) > 120:
                    print(f"      üìù –ù–∞—á–∞–ª–æ: \"{text[:60]}...\"")
                    print(f"      üìù –ö–æ–Ω–µ—Ü:  \"...{text[-60:]}\"")
                else:
                    print(f"      üìù –¢–µ–∫—Å—Ç: \"{text}\"")
                break

        if not found:
            print(f"   ‚ùå {target_ts}: –ù–ï –ù–ê–ô–î–ï–ù! "
                  f"(–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª—ë–Ω –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç—Ç–∞–ø–∞—Ö)")
4.2. –ì–¥–µ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑—ã–≤–∞—Ç—å checkpoint
–í process_audio_file():

python
debug_checkpoint(segments_raw,    "AFTER ALIGNMENT")
debug_checkpoint(segments_raw,    "AFTER JOURNALIST COMMANDS")
debug_checkpoint(segments_raw,    "AFTER BOUNDARY CORRECTION")
debug_checkpoint(segments_raw,    "AFTER CROSS-SPEAKER DEDUP")
debug_checkpoint(segments_raw,    "AFTER DEDUPLICATION")
debug_checkpoint(segments_raw,    "AFTER GAP FILLING")            # –µ—Å–ª–∏ –±—ã–ª–∏ gaps
debug_checkpoint(segments_raw,    "AFTER TIMESTAMP CORRECTION")

debug_checkpoint(segments_merged, "AFTER MERGE")
debug_checkpoint(segments_merged, "AFTER TIMESTAMP INJECTION")
debug_checkpoint(segments_merged, "AFTER CLASSIFICATION")
debug_checkpoint(segments_merged, "AFTER SPLIT")
debug_checkpoint(segments_merged, "AFTER TEXT CORRECTION")
debug_checkpoint(segments_merged, "AFTER HALLUCINATION REMOVAL")
debug_checkpoint(segments_merged, "AFTER AUTO-MERGE")             # –µ—Å–ª–∏ –±—ã–ª auto-merge
debug_checkpoint(segments_merged, "BEFORE EXPORT (FINAL)")
–ü—Ä–∞–≤–∏–ª–æ v16.28:
–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –º–µ–Ω—è–µ—Ç seg["text"] –∏–ª–∏ –≥—Ä–∞–Ω–∏—Ü—ã (start / end), checkpoint –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–µ—ë.

5. 5 Whys (Root Cause)
–®–∞–±–ª–æ–Ω –¥–ª—è –ª—é–±–æ–≥–æ –±–∞–≥–∞:

–ü–æ—á–µ–º—É –ø—Ä–æ—è–≤–∏–ª—Å—è —Å–∏–º–ø—Ç–æ–º?

–ü–æ—á–µ–º—É —ç—Ç–æ—Ç —ç—Ñ—Ñ–µ–∫—Ç –≤–æ–æ–±—â–µ –≤–æ–∑–º–æ–∂–µ–Ω –≤ –∫–æ–¥–µ?

–ü–æ—á–µ–º—É —ç—Ç–æ –Ω–µ –ø–æ–π–º–∞–ª–∏ —Ç–µ—Å—Ç—ã/–≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã?

–ü–æ—á–µ–º—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∑–≤–æ–ª–∏–ª–∞ –±–∞–≥—É –ø—Ä–æ–π—Ç–∏?

–ö–∞–∫–æ–µ –∫–æ—Ä–Ω–µ–≤–æ–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–µ/–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–≤–µ–ª–æ –∫ —ç—Ç–æ–º—É?

–ü—Ä–∏–º–µ—Ä –¥–ª—è –ë–ê–ì #3 (—É—Å–µ—á—ë–Ω–Ω–æ):

–ü–æ—á–µ–º—É –ø—Ä–æ–ø–∞–ª–∞ —Ñ—Ä–∞–∑–∞?
‚Üí insert_intermediate_timestamps() –æ–±—Ä–µ–∑–∞–ª–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.

–ü–æ—á–µ–º—É –æ–±—Ä–µ–∑–∞–ª–∞?
‚Üí range(0, len(sentences)-1, 2) –ø—Ä–æ–ø—É—Å–∫–∞–ª –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞.

–ü–æ—á–µ–º—É –Ω–µ –ø–æ–π–º–∞–ª–∏?
‚Üí –ù–µ –±—ã–ª–æ unit‚Äë—Ç–µ—Å—Ç–∞ –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.

–ü–æ—á–µ–º—É –Ω–µ —Å–¥–µ–ª–∞–ª–∏ unit‚Äëtest?
‚Üí –ù–µ –æ—Ç–¥–µ–ª–∏–ª–∏ –ø–∞—Ä—Å–µ—Ä –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –≤ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—É—é —É—Ç–∏–ª–∏—Ç—É.

ROOT CAUSE:
‚Üí –û—à–∏–±–∫–∞ –≤ —É—Ç–∏–ª–∏—Ç–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ + –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ unit‚Äë—Ç–µ—Å—Ç–∞ –Ω–∞ –Ω–µ—ë.

6. –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Ñ–∏–∫—Å–æ–º
–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥:

 –ü–æ–Ω–∏–º–∞—é, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ pipeline –ø–æ—è–≤–ª—è–µ—Ç—Å—è –±–∞–≥ (–ø–æ checkpoint‚Äô–∞–º)

 –ï—Å—Ç—å debug‚Äë–ª–æ–≥–∏ –¥–æ –∏ –ø–æ—Å–ª–µ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —ç—Ç–∞–ø–∞

 –ó–∞–ø–∏—Å–∞–Ω —Å–∏–º–ø—Ç–æ–º + –ø—Ä–∏–º–µ—Ä (timestamp + —Ç–µ–∫—Å—Ç)

 –ü–ª–∞–Ω–∏—Ä—É—é –º–∏–Ω–∏–º—É–º –∏–∑–º–µ–Ω–µ–Ω–∏–π (1 —Ñ—É–Ω–∫—Ü–∏—è / 1 –º–æ–¥—É–ª—å)

 –ü–æ–Ω–∏–º–∞—é, –∫–∞–∫ –±—É–¥—É –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–∏–∫—Å (Real test + VALIDATION.md)

–ü–æ—Å–ª–µ —Ñ–∏–∫—Å–∞:

 –û–±–Ω–æ–≤–ª—ë–Ω VERSION.md (–≤–µ—Ä—Å–∏—è + ROOT CAUSE + FIX)

 –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã DEBUGGING.md, ARCHITECTURE.md, TESTING-STRATEGY.md

 –†–µ–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω, 7 –ø—É–Ω–∫—Ç–æ–≤ VALIDATION.md ‚Äî GREEN