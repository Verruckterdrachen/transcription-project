# üß™ TESTING-STRATEGY.md ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è v16.28

–§–∏–ª–æ—Å–æ—Ñ–∏—è:

- **Real tests > Integration > Unit**
- Unit tests ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç.
- –õ—é–±–æ–π –±–∞–≥ ‚Üí —Å–Ω–∞—á–∞–ª–∞ real test + debug ‚Üí –ø–æ—Ç–æ–º —É–∂–µ —é–Ω–∏—Ç—ã (–µ—Å–ª–∏ —É–º–µ—Å—Ç–Ω–æ).

---

## 1. –£—Ä–æ–≤–Ω–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **Real tests (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)**  
   –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ `scripts/transcribe.py` –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–≤—å—é:
   - –ø—Ä–æ–≤–µ—Ä–∫–∞ JSON –∏ TXT;
   - –ø—Ä–æ–≤–µ—Ä–∫–∞ 7 –ø—É–Ω–∫—Ç–æ–≤ `VALIDATION.md`.

2. **Integration tests (–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)**  
   –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥—É–ª–µ–π:
   - –Ω–∞–ø—Ä–∏–º–µ—Ä, `replica_merger` + `txt_export`;
   - –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π.

3. **Unit tests (—Ç–æ—á–µ—á–Ω–æ)**  
   –¢–æ–ª—å–∫–æ –¥–ª—è:
   - —á–∏—Å—Ç—ã—Ö —É—Ç–∏–ª–∏—Ç (regex, –ø–∞—Ä—Å–∏–Ω–≥, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ);
   - —Ñ—É–Ω–∫—Ü–∏–π –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π –∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º.

---

## 2. –ö–æ–≥–¥–∞ unit‚Äë—Ç–µ—Å—Ç—ã –ù–ï –ù–£–ñ–ù–´

–ù–µ —Å–æ–∑–¥–∞—ë–º unit‚Äëtests –¥–ª—è:

- –±–∞–≥–æ–≤ –Ω–∞ —Å—Ç—ã–∫–µ –º–æ–¥—É–ª–µ–π (–ø—Ä–∏–º–µ—Ä: `replica_merger` + `txt_export`);
- –ª–æ–≥–∏–∫–∏, —Å–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å—è—â–µ–π –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–∞;
- —Å–ª–æ–∂–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —à–∞–≥–∞–º–∏ (–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã).

**–ü—Ä–∏—á–∏–Ω–∞:** —Ç–∞–∫–∏–µ –±–∞–≥–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ ¬´–ø—Ä–æ–ª–µ–∑—É—Ç¬ª —á–µ—Ä–µ–∑ unit‚Äëtests –∏ –ø—Ä–æ—è–≤—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ real test ‚Üí –ª–æ–∂–Ω–æ–µ —á—É–≤—Å—Ç–≤–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## 3. –ö–æ–≥–¥–∞ unit‚Äë—Ç–µ—Å—Ç—ã –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´ (—É—Ä–æ–∫ –ë–ê–ì #3)

–ë–ê–ì #3 –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ **—É—Ç–∏–ª–∏—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞** –¥–æ–ª–∂–Ω—ã –ø–æ–∫—Ä—ã–≤–∞—Ç—å—Å—è unit‚Äë—Ç–µ—Å—Ç–∞–º–∏.

### 3.1. –ü—Ä–∏–º–µ—Ä: –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

–í–æ –≤—Ä–µ–º—è —Ñ–∏–∫—Å–∞ –ë–ê–ì #3 –≤—ã—è—Å–Ω–∏–ª–æ—Å—å:

- –í `insert_intermediate_timestamps()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è;
- –æ—à–∏–±–∫–∞ –≤ `range(0, len(sentences)-1, 2)` –ø—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ –ø–æ—Ç–µ—Ä–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è;
- —ç—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞, –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–∞—è –±–µ–∑ –≤—Å–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞.

**–í—ã–≤–æ–¥:** –Ω—É–∂–µ–Ω unit‚Äëtest –¥–ª—è —É—Ç–∏–ª–∏—Ç—ã, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—ã–¥–µ–ª–∏—Ç—å:

```python
# corrections/timestamp_fixer.py

import re

def parse_sentences(text: str) -> list[str]:
    """
    –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
    –¢–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, –±–µ–∑ —É—á–∞—Å—Ç–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞.
    """
    parts = re.split(r'([.!?]+)\s+', text)
    sentences = [
        ''.join(parts[i:i+2]).strip()
        for i in range(0, len(parts), 2)
    ]
    return [s for s in sentences if s]
3.2. –ü—Ä–∏–º–µ—Ä—ã, –≥–¥–µ —é–Ω–∏—Ç—ã –Ω—É–∂–Ω—ã
parse_sentences(text) ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.

seconds_to_hms(seconds) ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ timestamp‚Äô–æ–≤.

–õ—é–±–æ–π helper, –∫–æ—Ç–æ—Ä—ã–π:

–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç JSON/pyannote/Whisper;

–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ¬´—á–∏—Å—Ç—ã–µ¬ª –¥–∞–Ω–Ω—ã–µ (—Å—Ç—Ä–æ–∫–∏, —á–∏—Å–ª–∞, —Å–ø–∏—Å–∫–∏, dict).

4. –ü—Ä–∏–º–µ—Ä unit‚Äë—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ (—à–∞–±–ª–æ–Ω)
python
# tests/test_sentence_parsing.py

import pytest
from corrections.timestamp_fixer import parse_sentences

def test_parse_sentences_three_simple():
    text = "–ü–µ—Ä–≤–æ–µ. –í—Ç–æ—Ä–æ–µ. –¢—Ä–µ—Ç—å–µ."
    sentences = parse_sentences(text)

    assert len(sentences) == 3
    assert sentences == "–ü–µ—Ä–≤–æ–µ."
    assert sentences == "–í—Ç–æ—Ä–æ–µ."
    assert sentences == "–¢—Ä–µ—Ç—å–µ."

def test_parse_sentences_without_final_dot():
    text = "–ü–µ—Ä–≤–æ–µ. –í—Ç–æ—Ä–æ–µ. –¢—Ä–µ—Ç—å–µ –±–µ–∑ —Ç–æ—á–∫–∏"
    sentences = parse_sentences(text)

    assert len(sentences) == 3
    assert "–¢—Ä–µ—Ç—å–µ –±–µ–∑ —Ç–æ—á–∫–∏" in sentences[-1]

def test_parse_sentences_mixed_punctuation():
    text = "–í–æ–ø—Ä–æ—Å? –í–æ—Å–∫–ª–∏—Ü–∞–Ω–∏–µ! –û–±—ã—á–Ω–æ–µ."
    sentences = parse_sentences(text)

    assert len(sentences) == 3
    assert sentences == "–í–æ–ø—Ä–æ—Å?"
    assert sentences == "–í–æ—Å–∫–ª–∏—Ü–∞–Ω–∏–µ!"
    assert sentences == "–û–±—ã—á–Ω–æ–µ."

def test_parse_sentences_real_bug_example():
    text = ("–ù–æ —Å–∞–º–æ –Ω–∞–ª–∏—á–∏–µ ¬´–í–æ—Å—å–º–æ–π –ì–†–≠–°¬ª —Å–≤–æ–¥–∏–ª–æ –≤—Å–µ —ç—Ç–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ "
            "–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫ –Ω—É–ª—é, –∏ –Ω–∏—á–µ–≥–æ —Å –Ω–µ–π —Å–¥–µ–ª–∞—Ç—å –Ω–µ –º–æ–≥–ª–∏ –æ—Å–µ–Ω—å—é –∏ "
            "–≤ –Ω–∞—á–∞–ª–µ –∑–∏–º—ã 1941 –≥–æ–¥–∞. –¢–æ –µ—Å—Ç—å —ç—Ç–æ –±—ã–ª —Ç–∞–∫–æ–π –ø—É–Ω–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π "
            "–¥–µ–ª–∞–ª –¥–ª—è –Ω–µ–º—Ü–µ–≤ –æ–±–æ—Ä–æ–Ω—É —ç—Ç–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ –ù–µ–≤—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç—ã–º "
            "—Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–∏ –∏ —Ç–∞–∫—Ç–∏–∫–∏.")
    sentences = parse_sentences(text)

    assert len(sentences) >= 2
    assert any("–¢–æ –µ—Å—Ç—å —ç—Ç–æ –±—ã–ª —Ç–∞–∫–æ–π –ø—É–Ω–∫—Ç" in s for s in sentences)
5. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –±–∞–≥–∞
–í–°–ï–ì–î–ê —Å–Ω–∞—á–∞–ª–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–∏ –±–∞–≥ real test‚Äô–æ–º:

python scripts/transcribe.py;

—Å–æ—Ö—Ä–∞–Ω–∏ JSON/TXT/–ª–æ–≥ –≤ test-results/latest/.

–° –ø–æ–º–æ—â—å—é debug‚Äëcheckpoint‚Äô–æ–≤ –Ω–∞–π–¥–∏ —ç—Ç–∞–ø, –≥–¥–µ –≤—Å—ë –ª–æ–º–∞–µ—Ç—Å—è.

–ï—Å–ª–∏ –∫–æ—Ä–µ–Ω—å –≤ —É—Ç–∏–ª–∏—Ç–µ:

–≤—ã–¥–µ–ª–∏ –µ—ë –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç);

–Ω–∞–ø–∏—à–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π unit‚Äëtest;

–ø–æ—á–∏–Ω–∏ –∫–æ–¥ —Ç–∞–∫, —á—Ç–æ–±—ã test —Å—Ç–∞–ª GREEN.

–ï—Å–ª–∏ –∫–æ—Ä–µ–Ω—å –≤–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ –º–æ–¥—É–ª–µ–π:

–ù–ï —Ç—Ä–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞ unit‚Äëtests;

–ø—Ä–∞–≤—å –∫–æ–¥, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ real test + debug;

–æ–ø–∏—à–∏ –∫–µ–π—Å –≤ GOLDEN-DATASET.md –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

6. –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º (–ø–æ —Ç–µ—Å—Ç–∞–º)
 –ï—Å—Ç—å real test –Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω–æ–º –∏–Ω—Ç–µ—Ä–≤—å—é.

 –í—Å–µ 7 –ø—É–Ω–∫—Ç–æ–≤ VALIDATION.md ‚Äî GREEN.

 –î–ª—è –Ω–æ–≤—ã—Ö/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç (parsers / formatters) –¥–æ–±–∞–≤–ª–µ–Ω—ã unit‚Äëtests.

 VERSION.md –æ–±–Ω–æ–≤–ª—ë–Ω (–≤–µ—Ä—Å–∏—è + ROOT CAUSE + FIX).

 –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã DEBUGGING.md, ARCHITECTURE.md.