# üìö –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–æ–¥—É–ª–µ–π –∏ —Ñ—É–Ω–∫—Ü–∏–π

–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ–µ–∫—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

---

## üìÇ scripts/core/ - –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### config.py

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```python
HF_TOKEN: str
    Hugging Face API —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–æ–¥–µ–ª—è–º

VERSION: str
    –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "16.5")

VERSION_NAME: str
    –ö–æ–¥–æ–≤–æ–µ –∏–º—è –≤–µ—Ä—Å–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "Smart GAP Attribution")
utils.py
seconds_to_hms(seconds: float) -> str
–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å–µ–∫—É–Ω–¥—ã –≤ —Ñ–æ—Ä–º–∞—Ç HH:MM:SS.mmm

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

seconds: –í—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°—Ç—Ä–æ–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ "HH:MM:SS.mmm"

–ü—Ä–∏–º–µ—Ä:

python
seconds_to_hms(125.456)
# ‚Üí "00:02:05.456"
parse_speaker_folder(folder_name: str) -> Tuple[str, str, str]
–ü–∞—Ä—Å–∏—Ç –∏–º—è –ø–∞–ø–∫–∏ —Å–ø–∏–∫–µ—Ä–∞

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

folder_name: –ò–º—è –ø–∞–ø–∫–∏ (—Ñ–æ—Ä–º–∞—Ç: "–§–∞–º–∏–ª–∏—è (–î–î.–ú–ú)")

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (surname, date, full_name)

–ü—Ä–∏–º–µ—Ä:

python
parse_speaker_folder("–ò—Å–∞–µ–≤ (29.01)")
# ‚Üí ("–ò—Å–∞–µ–≤", "29.01", "–ò—Å–∞–µ–≤")
adaptive_vad_threshold(duration: float) -> float
–í—ã—á–∏—Å–ª—è–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π VAD threshold –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

duration: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–¥–∏–æ (—Å–µ–∫—É–Ω–¥—ã)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: VAD threshold (0.3-0.5)

–õ–æ–≥–∏–∫–∞:

python
if duration < 600:      # <10 –º–∏–Ω ‚Üí 0.3
elif duration < 1800:   # 10-30 –º–∏–Ω ‚Üí 0.4
else:                   # >30 –º–∏–Ω ‚Üí 0.5
gap_detector(segments: List[Dict], threshold: float = 3.0) -> List[Dict]
–û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –ø–∞—É–∑—ã (gaps) –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

threshold: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—É–∑—ã (default: 3.0s)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ gaps —Å –ø–æ–ª—è–º–∏:

python
{
    "gap_hms_start": "00:05:30.000",
    "gap_hms_end": "00:05:35.000",
    "start": 330.0,
    "end": 335.0,
    "duration": 5.0
}
text_similarity(text1: str, text2: str) -> float
üÜï v16.5: –í—ã—á–∏—Å–ª—è–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –¥–≤—É—Ö —Ç–µ–∫—Å—Ç–æ–≤

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

text1, text2: –¢–µ–∫—Å—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å—Ö–æ–¥—Å—Ç–≤–∞ (0.0-1.0)

–ê–ª–≥–æ—Ä–∏—Ç–º: Jaccard similarity –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–ª–æ–≤

–ü—Ä–∏–º–µ—Ä:

python
text_similarity("–î–æ–±—Ä—ã–π –¥–µ–Ω—å", "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä")
# ‚Üí 0.67 (2 –æ–±—â–∏—Ö —Å–ª–æ–≤–∞ –∏–∑ 3)
diarization.py
diarize_audio(pipeline, audio_path: Path, min_speakers: int, max_speakers: int) -> Annotation
–í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–∏–∞—Ä–∏–∑–∞—Ü–∏—é –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

pipeline: Pyannote pipeline

audio_path: –ü—É—Ç—å –∫ WAV —Ñ–∞–π–ª—É

min_speakers: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∏–∫–µ—Ä–æ–≤ (–æ–±—ã—á–Ω–æ 2)

max_speakers: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∏–∫–µ—Ä–æ–≤ (–æ–±—ã—á–Ω–æ 3)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Pyannote Annotation –æ–±—ä–µ–∫—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏ —Å–ø–∏–∫–µ—Ä–æ–≤

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

python
pipeline = Pipeline.from_pretrained("pyannote/speaker-diarization-3.1")
diarization = diarize_audio(pipeline, Path("audio.wav"), 2, 3)
compute_speaker_stats(diarization: Annotation) -> Dict[str, Dict]
–í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É —Å–ø–∏–∫–µ—Ä—É

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

diarization: –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

python
{
    "SPEAKER_00": {
        "total_time": 1234.5,
        "num_segments": 89
    },
    ...
}
identify_speaker_roles(stats: Dict, segments: List[Dict]) -> Dict[str, str]
–ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ä–æ–ª–∏ —Å–ø–∏–∫–µ—Ä–æ–≤ (–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç/–≠–∫—Å–ø–µ—Ä—Ç/–û–ø–µ—Ä–∞—Ç–æ—Ä)

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

stats: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–ø–∏–∫–µ—Ä–æ–≤

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

python
{
    "SPEAKER_00": "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç",
    "SPEAKER_01": "–≠–∫—Å–ø–µ—Ä—Ç",
    "SPEAKER_02": "–û–ø–µ—Ä–∞—Ç–æ—Ä"  # –µ—Å–ª–∏ –µ—Å—Ç—å
}
–õ–æ–≥–∏–∫–∞:

–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è ‚Üí –ñ—É—Ä–Ω–∞–ª–∏—Å—Ç

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è ‚Üí –≠–∫—Å–ø–µ—Ä—Ç

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π ‚Üí –û–ø–µ—Ä–∞—Ç–æ—Ä

align_segment_to_diarization(segment: Dict, diarization: Annotation) -> str
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–ø–∏–∫–µ—Ä–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segment: –°–µ–≥–º–µ–Ω—Ç —Å –ø–æ–ª—è–º–∏ start, end

diarization: –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: ID —Å–ø–∏–∫–µ—Ä–∞ ("SPEAKER_00", "SPEAKER_01", ...)

alignment.py
align_whisper_with_diarization(segments: List[Dict], diarization: Annotation, speaker_surname: str, speaker_roles: Dict) -> List[Dict]
–°–≤—è–∑—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é Whisper —Å –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–µ–π

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–µ–≥–º–µ–Ω—Ç—ã –æ—Ç Whisper

diarization: –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏

speaker_surname: –§–∞–º–∏–ª–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞

speaker_roles: –†–æ–ª–∏ —Å–ø–∏–∫–µ—Ä–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏:

python
{
    "start": 0.0,
    "end": 5.3,
    "text": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å!",
    "speaker": "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç",
    "raw_speaker_id": "SPEAKER_00",
    "confidence": 0.95
}
transcription.py
transcribe_audio(model, audio_path: Path, language: str, temperature: float, beam_size: int, vad_threshold: float) -> Dict
–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ —Å –ø–æ–º–æ—â—å—é Whisper

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

model: –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å Whisper

audio_path: –ü—É—Ç—å –∫ WAV —Ñ–∞–π–ª—É

language: –ö–æ–¥ —è–∑—ã–∫–∞ ("ru")

temperature: 0.0 –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞

beam_size: 5 –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞

vad_threshold: –ü–æ—Ä–æ–≥ VAD (0.3-0.5)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

python
{
    "text": "–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç",
    "segments": [
        {
            "start": 0.0,
            "end": 5.3,
            "text": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å!",
            "confidence": 0.95
        },
        ...
    ]
}
force_transcribe_diar_gaps(model, audio_path: Path, gaps: List[Dict], segments: List[Dict], speaker_surname: str) -> List[Dict]
üÜï v16.5: –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ (gaps) —Å —É–º–Ω–æ–π –∞—Ç—Ä–∏–±—É—Ü–∏–µ–π

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

model: –ú–æ–¥–µ–ª—å Whisper

audio_path: –ü—É—Ç—å –∫ –∞—É–¥–∏–æ

gaps: –°–ø–∏—Å–æ–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö gaps

segments: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)

speaker_surname: –§–∞–º–∏–ª–∏—è —Å–ø–∏–∫–µ—Ä–∞

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ gaps

–ù–æ–≤–æ–µ –≤ v16.5:

–£–º–Ω–∞—è –∞—Ç—Ä–∏–±—É—Ü–∏—è –ø–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–º—É —Å—Ö–æ–¥—Å—Ç–≤—É

–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç—Ä–∏–±—É—Ü–∏–∏ –∑–∞–ø–∏–Ω–æ–∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–ø–∏–∫–µ—Ä—É

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ text_similarity() –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–ê–ª–≥–æ—Ä–∏—Ç–º:

python
gap_text = transcribe_gap_audio()

# –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å —Å–æ—Å–µ–¥–Ω–∏–º–∏ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏
similarity_prev = text_similarity(gap_text, prev_segment["text"])
similarity_next = text_similarity(gap_text, next_segment["text"])

if similarity_prev > similarity_next:
    speaker = prev_segment["speaker"]
else:
    speaker = next_segment["speaker"]

# –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–ø–∏–Ω–æ–∫
if len(gap_text) < 10 or confidence < 0.6:
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–∞—Ä–∏–∑–∞—Ü–∏—é –≤–º–µ—Å—Ç–æ —Å–µ–º–∞–Ω—Ç–∏–∫–∏
    speaker = diarization_speaker
üìÇ scripts/corrections/ - –ö–æ—Ä—Ä–µ–∫—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
hallucinations.py
filter_hallucination_segments(segments: List[Dict]) -> List[Dict]
–§–∏–ª—å—Ç—Ä—É–µ—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ Whisper

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏:

–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è —Ç–µ–∫—Å—Ç (>3 —Ä–∞–∑–∞)

–ù–∏–∑–∫–∞—è confidence (<0.4)

–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

clean_hallucinations_from_text(text: str) -> str
–û—á–∏—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –æ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

text: –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –û—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

–ü—Ä–∏–º–µ—Ä—ã —É–¥–∞–ª—è–µ–º–æ–≥–æ:

"–°—É–±—Ç–∏—Ç—Ä—ã —Å–¥–µ–ª–∞–ª DimaTorzok"

"–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª"

–ü–æ–≤—Ç–æ—Ä—ã —Ñ—Ä–∞–∑

speaker_classifier.py
apply_speaker_classification_v15(segments: List[Dict], speaker_surname: str, debug: bool = False) -> Tuple[List[Dict], Dict]
–í–µ—Å–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–ø–∏–∫–µ—Ä–æ–≤

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

speaker_surname: –§–∞–º–∏–ª–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞

debug: –í—ã–≤–æ–¥ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (segments_updated, stats)

–°–∏—Å—Ç–µ–º–∞ –≤–µ—Å–æ–≤:

python
{
    "duration": 0.30,    # –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∏
    "position": 0.15,    # –ü–æ–∑–∏—Ü–∏—è –≤ –∏–Ω—Ç–µ—Ä–≤—å—é
    "pattern": 0.25,     # –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
    "context": 0.20,     # –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å–µ–¥–µ–π
    "diarization": 0.10  # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞
}
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

python
{
    "total_corrections": 15,
    "journalist_to_expert": 8,
    "expert_to_journalist": 7,
    "avg_confidence": 0.85
}
boundary_fixer.py
boundary_correction_raw(segments: List[Dict], speaker_surname: str, speaker_roles: Dict) -> List[Dict]
–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

speaker_surname: –§–∞–º–∏–ª–∏—è —Å–ø–∏–∫–µ—Ä–∞

speaker_roles: –†–æ–ª–∏ —Å–ø–∏–∫–µ—Ä–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏

–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç:

–ü–µ—Ä–µ–∫—Ä—ã—Ç–∏—è —Ç–∞–π–º–∫–æ–¥–æ–≤

–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ/–¥–ª–∏–Ω–Ω—ã–µ –ø–∞—É–∑—ã

–†–∞–∑—Ä—ã–≤—ã –≤ –¥–∏–∞–ª–æ–≥–µ

split_mixed_speaker_segments(segments: List[Dict], speaker_surname: str) -> List[Dict]
üîß v16.4: –†–∞–∑–¥–µ–ª—è–µ—Ç mixed-speaker —Å–µ–≥–º–µ–Ω—Ç—ã —Å –ø–µ—Ä–µ—Å—á—ë—Ç–æ–º —Ç–∞–π–º–∫–æ–¥–æ–≤

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

speaker_surname: –§–∞–º–∏–ª–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ —Å —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–º–∏ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏

–ü—Ä–∏–º–µ—Ä:

python
# –î–æ:
[{"text": "–î–∞, –ø–æ–Ω—è—Ç–Ω–æ. [–≤–º–µ—à–∏–≤–∞–µ—Ç—Å—è] –ü—Ä–æ–¥–æ–ª–∂—É", "speaker": "–≠–∫—Å–ø–µ—Ä—Ç"}]

# –ü–æ—Å–ª–µ:
[
    {"text": "–î–∞, –ø–æ–Ω—è—Ç–Ω–æ.", "speaker": "–≠–∫—Å–ø–µ—Ä—Ç"},
    {"text": "–≤–º–µ—à–∏–≤–∞–µ—Ç—Å—è", "speaker": "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç"},
    {"text": "–ü—Ä–æ–¥–æ–ª–∂—É", "speaker": "–≠–∫—Å–ø–µ—Ä—Ç"}
]
journalist_commands.py
detect_journalist_commands_cross_segment(segments: List[Dict], speaker_surname: str) -> Tuple[List[Dict], List[Dict]]
–î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ñ—É—Ä–Ω–∞–ª–∏—Å—Ç–∞, –ø—Ä–∏–ø–∏—Å–∞–Ω–Ω—ã–µ –≠–∫—Å–ø–µ—Ä—Ç—É

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

speaker_surname: –§–∞–º–∏–ª–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (corrected_segments, corrections_log)

–î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:

python
[
    "–¥–∞–≤–∞–π—Ç–µ", "–ø–æ–∂–∞–ª—É–π—Å—Ç–∞", "—Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ",
    "–º–æ–∂–µ—Ç–µ", "–æ–±—ä—è—Å–Ω–∏—Ç–µ", "–ø–æ–∫–∞–∂–∏—Ç–µ"
]
text_corrections.py
text_based_correction(segments: List[Dict], speaker_surname: str) -> List[Dict]
üîß v16.4: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

speaker_surname: –§–∞–º–∏–ª–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫

–ù–æ–≤–æ–µ –≤ v16.4:

Context window protection (–º–æ–Ω–æ–ª–æ–≥–∏ >60s)

Confirmation pattern detection

Announcement vs Question distinction

–ü—Ä–∏–º–µ—Ä—ã –∑–∞—â–∏—Ç—ã:

python
# Context Window Protection
if in_long_monologue(segment, threshold=60):
    skip_correction()  # –ù–µ —Ç—Ä–æ–≥–∞—Ç—å —Å–µ—Ä–µ–¥–∏–Ω—É –º–æ–Ω–æ–ª–æ–≥–∞

# Confirmation Detection
if text in ["–Ω—É –¥–∞", "–¥–∞-–¥–∞", "—É–≥—É"] and duration < 2:
    force_journalist()

# Announcement vs Question
if text.startswith("–¥–∞–≤–∞–π—Ç–µ") and len(text) < 50:
    force_journalist()  # –ö–æ—Ä–æ—Ç–∫–∏–π –∞–Ω–æ–Ω—Å
üìÇ scripts/merge/ - –°–ª–∏—è–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
replica_merger.py
merge_replicas(segments: List[Dict]) -> List[Dict]
–û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ —Ä–µ–ø–ª–∏–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ —Å –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–º–∏ —Ä–µ–ø–ª–∏–∫–∞–º–∏

–£—Å–ª–æ–≤–∏—è —Å–ª–∏—è–Ω–∏—è:

python
same_speaker and
pause < 3.0 and
same_raw_speaker_id and  # v16.0+
total_duration < 60
deduplicator.py
remove_cross_speaker_text_duplicates(segments: List[Dict]) -> List[Dict]
–£–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã —Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–∏–∫–µ—Ä–∞–º–∏

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–ü—Ä–∏–º–µ—Ä:

python
# –î–æ:
–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç: "–î–∞-–¥–∞, –ø–æ–Ω—è—Ç–Ω–æ, –¥–∞"
–≠–∫—Å–ø–µ—Ä—Ç: "–î–∞, –ø–æ–Ω—è—Ç–Ω–æ"  ‚Üê –¥—É–±–ª–∏–∫–∞—Ç

# –ü–æ—Å–ª–µ:
–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç: "–î–∞-–¥–∞, –ø–æ–Ω—è—Ç–Ω–æ, –¥–∞"
–≠–∫—Å–ø–µ—Ä—Ç: ""  ‚Üê —É–¥–∞–ª—ë–Ω
deduplicate_segments(segments: List[Dict]) -> List[Dict]
–£–¥–∞–ª—è–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

validator.py
validate_adjacent_same_speaker(segments: List[Dict]) -> List[Tuple[int, int]]
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–º–µ–∂–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ –ø–∞—Ä –∏–Ω–¥–µ–∫—Å–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏

–ü—Ä–∏–º–µ—Ä:

python
errors = validate_adjacent_same_speaker(segments)
# ‚Üí [(5, 6), (12, 13)]  # –°–µ–≥–º–µ–Ω—Ç—ã 5-6 –∏ 12-13 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–ª–∏—Ç—ã
auto_merge_adjacent_same_speaker(segments: List[Dict]) -> List[Dict]
üîß v16.0: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–ª–∏–≤–∞–µ—Ç —Å–º–µ–∂–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π raw_speaker_id

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –°–ø–∏—Å–æ–∫ —Å–æ —Å–ª–∏—Ç—ã–º–∏ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏

–ù–æ–≤–æ–µ –≤ v16.0:

python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º raw_speaker_id –ø–µ—Ä–µ–¥ —Å–ª–∏—è–Ω–∏–µ–º
if (same_speaker and
    same_raw_speaker_id and  # ‚Üê –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ —Å–ª–∏—è–Ω–∏—è
    pause < 3.0):
    merge()
generate_validation_report(segments: List[Dict], speaker_surname: str) -> Dict
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

speaker_surname: –§–∞–º–∏–ª–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

python
{
    "total_segments": 241,
    "speakers": {
        "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç": 152,
        "–≠–∫—Å–ø–µ—Ä—Ç": 89
    },
    "total_duration": "01:53:47",
    "avg_segment_duration": {
        "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç": 5.2,
        "–≠–∫—Å–ø–µ—Ä—Ç": 18.7
    },
    "errors_found": 0,
    "warnings": [
        "Long pause at 00:15:32 (15s)"
    ]
}
üìÇ scripts/export/ - –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
json_export.py
export_to_json(json_path: Path, segments_raw: List, segments_merged: List, file_info: Dict, speaker_roles: Dict, validation_report: Dict, corrections_log: Dict)
–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ JSON

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

json_path: –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

segments_raw: –°–µ–≥–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è

segments_merged: –§–∏–Ω–∞–ª—å–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã

file_info: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ

speaker_roles: –†–æ–ª–∏ —Å–ø–∏–∫–µ—Ä–æ–≤

validation_report: –û—Ç—á—ë—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏

corrections_log: –õ–æ–≥ –∫–æ—Ä—Ä–µ–∫—Ü–∏–π

–°–æ–∑–¥–∞—ë—Ç: JSON —Ñ–∞–π–ª —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

txt_export.py
export_to_txt(txt_path: Path, segments: List[Dict])
–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–µ–≥–º–µ–Ω—Ç—ã –≤ TXT

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

txt_path: –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

segments: –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

–°–æ–∑–¥–∞—ë—Ç: TXT —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

text
[HH:MM:SS.mmm] –°–ø–∏–∫–µ—Ä: –¢–µ–∫—Å—Ç
jsons_to_txt(json_files: List[Path], txt_path: Path, speaker_surname: str)
–û–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ JSON –≤ –æ–¥–∏–Ω TXT

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

json_files: –°–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –∫ JSON

txt_path: –ü—É—Ç—å –¥–ª—è TXT

speaker_surname: –§–∞–º–∏–ª–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞

–°–æ–∑–¥–∞—ë—Ç: –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π TXT —Å–æ –≤—Å–µ–º–∏ —Ä–µ–ø–ª–∏–∫–∞–º–∏ –∏–∑ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤