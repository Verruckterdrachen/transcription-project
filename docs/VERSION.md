# Version History

## v16.23 (2026-02-13)
**üêõ FIX –ë–ê–ì #1 + –ë–ê–ì #2 + –ë–ê–ì #3 + –ë–ê–ì #4: –ü–æ–ª–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Ç —Ñ–∏–∫—Å–æ–≤**

### –ò–∑–º–µ–Ω–µ–Ω–∏—è:

- **scripts/export/txt_export.py:**
  
  **–ë–ê–ì #1 (–î—É–±–ª–∏ timestamp) + –ë–ê–ì #2 (Timestamp –Ω–∞–∑–∞–¥):**
  - `insert_inner_timestamps()`: –î–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ `\n` –ø–µ—Ä–µ–¥ inner timestamp
  - –§–æ—Ä–º–∞—Ç: `"...—Ç–µ–∫—Å—Ç\n00:12:27 –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ..."` –≤–º–µ—Å—Ç–æ `"...—Ç–µ–∫—Å—Ç 00:12:27 –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ..."`
  - –ö–∞–∂–¥—ã–π inner timestamp = –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ (–∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞)
  - –ù–µ—Ç –¥—É–±–ª–µ–π, –Ω–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—ã –ø–æ—Ä—è–¥–∫–∞

- **scripts/corrections/boundary_fixer.py:**
  
  **–ë–ê–ì #3 (Loop artifacts):**
  - `detect_continuation_phrase()`: –ü–æ—Ä–æ–≥ –ø–æ–≤—ã—à–µ–Ω —Å 80% –¥–æ 90% (—É–∂–µ –±—ã–ª–æ –≤ v16.19)
  - –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π continuation phrases
  
  **–ë–ê–ì #4 (Adjacent same speaker):**
  - `split_mixed_speaker_segments()`: –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ raw_speaker_id
  - –°–æ–∑–¥–∞—ë–º –ü–û–õ–ù–´–ô –º–∞–ø–ø–∏–Ω–≥: –∏–º–µ–Ω–∞ + —Ä–æ–ª–∏ ‚Üí raw_speaker_id
  - –î–æ–±–∞–≤–ª–µ–Ω `reverse_roles[speaker_surname] = main_speaker_id`
  - –í—Å–µ —Å–µ–≥–º–µ–Ω—Ç—ã —Å –æ–¥–Ω–∏–º speaker —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –û–î–ò–ù–ê–ö–û–í–´–ô raw_speaker_id

- **scripts/merge/replica_merger.py:**
  
  **–ë–ê–ì #4 (Adjacent same speaker):**
  - `merge_replicas()`: –û—Å–ª–∞–±–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ v16.0 –¥–ª—è raw_speaker_id
  - –ï—Å–ª–∏ speaker –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π (–∏ —ç—Ç–æ –ù–ï "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç") ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ä–∞–∑–ª–∏—á–∏—è raw_speaker_id
  - Adjacent same speaker —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–ª–∏–≤–∞—é—Ç—Å—è

- **tests/test_txt_export.py:**
  - –ù–æ–≤—ã–π —Ñ–∞–π–ª: unit tests –¥–ª—è –ë–ê–ì #1, –ë–ê–ì #2
  - `test_no_duplicate_timestamps()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏
  - `test_timestamps_monotonic()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç–∏
  - `test_inner_timestamp_on_new_line()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏

- **tests/test_boundary_fixer.py:**
  - –ù–æ–≤—ã–π —Ñ–∞–π–ª: unit tests –¥–ª—è –ë–ê–ì #4
  - `test_raw_speaker_id_mapping()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ raw_speaker_id
  - `test_reverse_roles_includes_surname()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ —Ñ–∞–º–∏–ª–∏–∏

### Root Cause Analysis:

#### **–ë–ê–ì #1: –î—É–±–ª–∏ timestamp**
- **–°–∏–º–ø—Ç–æ–º:** `00:00:56 00:00:56 –¢–æ –µ—Å—Ç—å...`
- **–ü—Ä–∏—á–∏–Ω–∞:** Inner timestamp –≤—Å—Ç–∞–≤–ª—è–ª—Å—è –ë–ï–ó –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–Ω—Ü–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞, –∞ —Å–ª–µ–¥—É—é—â–∏–π –Ω–∞—á–∏–Ω–∞–ª—Å—è —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ timestamp —Ç–æ–≥–æ –∂–µ –≤—Ä–µ–º–µ–Ω–∏
- **Fix:** –î–æ–±–∞–≤–ª–µ–Ω `\n` –ø–µ—Ä–µ–¥ inner timestamp ‚Üí –∫–∞–∂–¥—ã–π –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ

#### **–ë–ê–ì #2: Timestamp –∏–¥—ë—Ç –Ω–∞–∑–∞–¥**
- **–°–∏–º–ø—Ç–æ–º:** `00:08:51 00:08:48 –ù–µ—Å–∫–æ–ª—å–∫–æ...`
- **–ü—Ä–∏—á–∏–Ω–∞:** Inner timestamp (00:08:48) + –æ—Å–Ω–æ–≤–Ω–æ–π timestamp (00:08:51) –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –∏–ª–ª—é–∑–∏—é "–Ω–∞–∑–∞–¥"
- **Fix:** –ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ—Ä—è–¥–∫–∞

#### **–ë–ê–ì #3: Loop artifacts**
- **–°–∏–º–ø—Ç–æ–º:** "—É—á–∏—Ç—ã–≤–∞—Ç—å, —É—á–∏—Ç—ã–≤–∞—Ç—å –±—ã–ª–∞... —É—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç–æ –±—ã–ª–æ..."
- **–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Ä–æ–≥ 80% –≤ `detect_continuation_phrase()` —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π
- **Fix:** –ü–æ–≤—ã—à–µ–Ω –¥–æ 90% (—É–∂–µ –±—ã–ª–æ –≤ v16.19, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è!)

#### **–ë–ê–ì #4: Adjacent same speaker**
- **–°–∏–º–ø—Ç–æ–º:** `00:23:07 –ò—Å–∞–µ–≤` ‚Üí `00:25:43 –ò—Å–∞–µ–≤` (–Ω–µ —Å–ª–∏–ª–∏—Å—å)
- **–ü—Ä–∏—á–∏–Ω–∞:** 
  1. `split_mixed_speaker_segments()` –Ω–µ —É–º–µ–ª –º–∞–ø–ø–∏—Ç—å "–ò—Å–∞–µ–≤" ‚Üí raw_speaker_id
  2. `reverse_roles` —Å–æ–¥–µ—Ä–∂–∞–ª —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏ ("–°–ø–∏–∫–µ—Ä"), –∞ –Ω–µ –∏–º–µ–Ω–∞ ("–ò—Å–∞–µ–≤")
  3. Fallback –±—Ä–∞–ª —Å—Ç–∞—Ä—ã–π raw_speaker_id ‚Üí —Å–æ—Å–µ–¥–Ω–∏–µ "–ò—Å–∞–µ–≤" –∏–º–µ–ª–∏ –†–ê–ó–ù–´–ï raw_speaker_id
  4. `merge_replicas()` –∑–∞—â–∏—Ç–∞ v16.0 –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ —Å–ª–∏—è–Ω–∏–µ (raw_speaker_id —Ä–∞–∑–Ω—ã–µ)
- **Fix:**
  1. –î–æ–±–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ `reverse_roles[speaker_surname] = main_speaker_id`
  2. –û—Å–ª–∞–±–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞: –µ—Å–ª–∏ speaker –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π (–æ—Å–Ω–æ–≤–Ω–æ–π) ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ä–∞–∑–ª–∏—á–∏—è raw_speaker_id

### Testing:

```bash
# –ë–ê–ì #1, #2:
python -m pytest tests/test_txt_export.py -v

# –ë–ê–ì #4:
python -m pytest tests/test_boundary_fixer.py -v
–ò—Ç–æ–≥–æ:
‚úÖ –§–∏–∫—Å—ã –¥–ª—è 4 –±–∞–≥–æ–≤ (–ë–ê–ì #1-4)

‚úÖ Unit tests –¥–ª—è –≤—Å–µ—Ö —Ñ–∏–∫—Å–æ–≤

‚úÖ Root Cause Analysis –¥–ª—è –∫–∞–∂–¥–æ–≥–æ

‚úÖ –¶–µ–ª—å: Bug-to-fix ‚â§3 –∏—Ç–µ—Ä–∞—Ü–∏–∏ (–±—ã–ª–æ 8)

v16.22 (2026-02-12)
üêõ FIX –ë–ê–ì #1 + –ë–ê–ì #2 + –ë–ê–ì #3: Timestamp –¥—É–±–ª–∏ + Timestamp –Ω–∞–∑–∞–¥ + Loop artifacts