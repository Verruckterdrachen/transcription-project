# VERSION v16.14

**Date:** 2026-02-11  
**Status:** ‚úÖ PRODUCTION

---

## üî• v16.14: Critical Fix - Speaker from LONGEST segment in replica_merger

### üÜï –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô FIX:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ speaker –ø—Ä–∏ merge —Ä–µ–ø–ª–∏–∫!

**–ü—Ä–æ–±–ª–µ–º–∞ v16.13:**
- `replica_merger.py` –±—Ä–∞–ª `speaker` –∏ `raw_speaker_id` –æ—Ç **–ü–ï–†–í–û–ì–û** —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ
- –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç –∫–æ—Ä–æ—Ç–∫–∏–π/–Ω–µ—É–≤–µ—Ä–µ–Ω–Ω—ã–π/GAP_FILLED, –≤—Å—è —Å–∫–ª–µ–π–∫–∞ –ø–æ–ª—É—á–∞–ª–∞ –µ–≥–æ speaker
- –ü—Ä–∏–º–µ—Ä: –∫–æ—Ä–æ—Ç–∫–∏–π —Å–µ–≥–º–µ–Ω—Ç –ñ—É—Ä–Ω–∞–ª–∏—Å—Ç–∞ + –¥–ª–∏–Ω–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã –ò—Å–∞–µ–≤–∞ ‚Üí –≤—Å—è —Ä–µ–ø–ª–∏–∫–∞ = –ñ—É—Ä–Ω–∞–ª–∏—Å—Ç ‚ùå
- v16.12-13 –∏—Å–ø—Ä–∞–≤–∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤ classifier/split, –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –≤ merge

**–†–µ—à–µ–Ω–∏–µ v16.14:**
1. ‚úÖ –ü—Ä–∏ merge —Å–æ–±–∏—Ä–∞–µ–º –í–°–ï —Å–µ–≥–º–µ–Ω—Ç—ã –≥—Ä—É–ø–ø—ã –≤ `all_segments_in_group`
2. ‚úÖ –ù–∞—Ö–æ–¥–∏–º **–¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π** —Å–µ–≥–º–µ–Ω—Ç: `max(segments, key=lambda s: len(s['text']))`
3. ‚úÖ –ë–µ—Ä—ë–º `speaker` –∏ `raw_speaker_id` –æ—Ç –°–ê–ú–û–ì–û –î–õ–ò–ù–ù–û–ì–û —Å–µ–≥–º–µ–Ω—Ç–∞
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω debug output: "üéØ –î–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π: –ò—Å–∞–µ–≤ / SPEAKER_01 (–¥–ª–∏–Ω–∞: 245 —Å–∏–º–≤–æ–ª–æ–≤)"
5. ‚úÖ –õ–æ–≥–∏–∫–∞: –¥–ª–∏–Ω–Ω—ã–π —Å–µ–≥–º–µ–Ω—Ç = –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π = –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π speaker

### üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`scripts/merge/replica_merger.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω –º–∞—Å—Å–∏–≤ `all_segments_in_group` –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ merge
   - –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ `texts` —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ `all_segments_in_group`
   - –ü–æ—Å–ª–µ merge: `dominant_segment = max(all_segments_in_group, key=lambda s: len(s.get('text', '')))`
   - –°—Ç—Ä–æ–∫–∞ 172: `"speaker": dominant_segment.get('speaker', current_speaker)`
   - –°—Ç—Ä–æ–∫–∞ 177: `"raw_speaker_id": dominant_segment.get('raw_speaker_id', '')`
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: `# üÜï v16.14: –ë–µ—Ä—ë–º speaker –æ—Ç –î–û–ú–ò–ù–ò–†–£–Æ–©–ï–ì–û —Å–µ–≥–º–µ–Ω—Ç–∞!`

2. **`scripts/transcribe.py`**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è: `VERSION = "16.14"`
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã –æ–ø–∏—Å–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ docstring

3. **`docs/VERSION.md`**
   - –û–ø–∏—Å–∞–Ω–∏–µ v16.14
   - –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ

---

## üîç –¢–µ—Å—Ç –∫–µ–π—Å

**–î–æ v16.14:**
```python
# –ü—Ä–∏ merge 3 —Å–µ–≥–º–µ–Ω—Ç–æ–≤:
segments = [
    {"speaker": "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç", "text": "–ö–æ—Ä–æ—Ç–∫–∏–π"},      # ‚Üê –ü–ï–†–í–´–ô (5 —Å–ª–æ–≤)
    {"speaker": "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç", "text": "–î–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ –≤–æ–π–Ω—É..."}, # (50 —Å–ª–æ–≤)
    {"speaker": "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç", "text": "–ï—â—ë –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç..."}  # (60 —Å–ª–æ–≤)
]

# replica_merger –±—Ä–∞–ª speaker –æ—Ç segments:
merged = {"speaker": "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç", "raw_speaker_id": "SPEAKER_00"}  # ‚ùå
