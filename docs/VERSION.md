# VERSION v16.21

**Date:** 2026-02-12  
**Status:** ‚úÖ STABLE

---

## üîß v16.21: Critical Fix - Infinite Loop –≤ replica_merger

### üêõ –ü—Ä–æ–±–ª–µ–º–∞ (v16.20)

**–°–∏–º–ø—Ç–æ–º:** Pipeline –∑–∞–≤–∏—Å–∞–ª –≤–æ –≤—Ä–µ–º—è `merge_replicas()` –Ω–∞ MERGE #31 (00:27:16)
- ‚ùå DEBUG log –æ–±—Ä—ã–≤–∞–ª—Å—è –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ merge
- ‚ùå TXT —Ñ–∞–π–ª –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –Ω–∞ 00:35:47 (–Ω–µ–ø–æ–ª–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
- ‚ùå Pipeline –ù–ï –¥–æ—Ö–æ–¥–∏–ª –¥–æ —Ñ–∏–Ω–∞–ª–∞

**Root Cause Analysis (5 Whys):**

1. **–ü–æ—á–µ–º—É pipeline –∑–∞–≤–∏—Å?**
   ‚Üí Log –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ MERGE #31, –¥–æ —Å—Ç—Ä–æ–∫–∏ `‚úÖ –°–∫–ª–µ–µ–Ω–æ X —Å–µ–≥–º–µ–Ω—Ç–æ–≤`

2. **–ü–æ—á–µ–º—É –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ merge?**
   ‚Üí –¶–∏–∫–ª `while j < len(segments) and merge_continue` –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

3. **–ü–æ—á–µ–º—É —Ü–∏–∫–ª –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è?**
   ‚Üí –í —Å—Ç—Ä–æ–∫–∞—Ö 115-120: –µ—Å–ª–∏ overlap > 2s –∏ similarity < 0.60, –∫–æ–¥ –¥–µ–ª–∞–ª:
   ```python
   else:
       # –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è overlap
       j += 1
       continue  # ‚Üê BUG!
–ü–æ—á–µ–º—É —ç—Ç–æ –±–∞–≥?
‚Üí j –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, –Ω–æ current_end –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
‚Üí –°–ª–µ–¥—É—é—â–∏–π —Å–µ–≥–º–µ–Ω—Ç —Ç–æ–∂–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ overlap —Å –ò–°–•–û–î–ù–´–ú current_end
‚Üí –ï—Å–ª–∏ –µ—Å—Ç—å —Ü–µ–ø–æ—á–∫–∞ —Ç–∞–∫–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ ‚Üí infinite loop!

ROOT CAUSE:
‚Üí –ü—Ä–∏ —Ü–µ–ø–æ—á–∫–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Å overlap > 2s –±–µ–∑ similarity —Ü–∏–∫–ª –∑–∞–≤–∏—Å–∞–ª,
–ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ –±—ã–ª–æ —É—Å–ª–æ–≤–∏—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.

üîß –†–µ—à–µ–Ω–∏–µ
FIX: –ò–∑–º–µ–Ω–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ 167 –≤ replica_merger.py:

python
# –ë—ã–ª–æ (v16.20):
else:
    j += 1
    continue  # ‚Üê infinite loop!

# –°—Ç–∞–ª–æ (v16.21):
else:
    print(f"    ‚Ü≥ Overlap {abs(pause):.1f}s –±–µ–∑ similarity ‚Üí ‚ùå STOP")
    merge_continue = False
    break  # ‚Üê –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º merge
–õ–æ–≥–∏–∫–∞: –ï—Å–ª–∏ overlap —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∏ –Ω–µ—Ç similarity –º–µ–∂–¥—É —Ç–µ–∫—Å—Ç–∞–º–∏,
–∑–Ω–∞—á–∏—Ç —ç—Ç–æ –£–ñ–ï –¥—Ä—É–≥–∞—è —Ä–µ–ø–ª–∏–∫–∞ ‚Üí –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å merge.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞: –î–æ–±–∞–≤–ª–µ–Ω —Å—á—ë—Ç—á–∏–∫ –∏—Ç–µ—Ä–∞—Ü–∏–π (max = 2 * len(segments)):

python
max_iterations = len(segments) * 2
iteration_count = 0

while j < len(segments) and merge_continue:
    iteration_count += 1
    if iteration_count > max_iterations:
        print(f"    ‚ö†Ô∏è –ó–ê–©–ò–¢–ê: –ø—Ä–µ–≤—ã—à–µ–Ω–æ {max_iterations} –∏—Ç–µ—Ä–∞—Ü–∏–π")
        break
–§–∞–π–ª—ã:

scripts/merge/replica_merger.py ‚Äî FIX infinite loop + –∑–∞—â–∏—Ç–∞

tests/test_replica_merger_freeze.py ‚Äî 3 unit tests (NEW)

docs/VERSION.md ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω –¥–æ v16.21

üß™ Unit Tests (NEW)
tests/test_replica_merger_freeze.py:

test_no_infinite_loop_on_large_overlap()

–°–æ–∑–¥–∞—ë—Ç —Ü–µ–ø–æ—á–∫—É —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Å overlap > 2s –±–µ–∑ similarity

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ merge –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è < 5 —Å–µ–∫—É–Ω–¥

‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç regression

test_merge_with_protection_trigger()

–°–æ–∑–¥–∞—ë—Ç 100 –ø–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∑–∞—â–∏—Ç–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è < 10 —Å–µ–∫—É–Ω–¥

test_normal_merge_still_works()

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –æ–±—ã—á–Ω—ã–π merge –Ω–µ —Å–ª–æ–º–∞–ª—Å—è –ø–æ—Å–ª–µ FIX

‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–∫–ª–µ–π–∫–∞ —Ä–µ–ø–ª–∏–∫ –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞

–ó–∞–ø—É—Å–∫:

bash
python tests/test_replica_merger_freeze.py
# –∏–ª–∏
pytest tests/test_replica_merger_freeze.py -v
üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–ö–æ–º–∞–Ω–¥–∞:

bash
python scripts/transcribe.py
# –í–≤–æ–¥–∏–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –ò—Å–∞–µ–≤ (27.05)
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ Pipeline –ø—Ä–æ—Ö–æ–¥–∏—Ç MERGE #31 –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏—è

‚úÖ TXT —Ñ–∞–π–ª –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ –∫–æ–Ω—Ü–∞ (~35 –º–∏–Ω—É—Ç –∞—É–¥–∏–æ)

‚úÖ –í LOG –≤–∏–¥–Ω–æ: "Overlap X.Xs –±–µ–∑ similarity ‚Üí ‚ùå STOP" –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö overlap

üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ pipeline –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

–ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –ò—Å–∞–µ–≤ (27.05)

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ TXT –∑–∞–ø–æ–ª–Ω–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –£–ª—É—á—à–∏—Ç—å clean_loops() –¥–ª—è loop artifacts

–¢–µ–∫—É—â–∏–µ loops —Å –≤–∞—Ä–∏–∞—Ü–∏—è–º–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è

–ù—É–∂–Ω–æ —É—Å–∏–ª–∏—Ç—å regex –¥–ª—è –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è "–ê, –ë, –ê" –≥–¥–µ –ë ‚Äî –≤–∞—Ä–∏–∞—Ü–∏—è –ê

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ timestamp_fixer/hallucinations

v16.22: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ clean_loops

v16.23: –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

‚èÆÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏
v16.20 (2026-02-12)
Debug Output - Replica Merger Freeze Detection

–î–æ–±–∞–≤–ª–µ–Ω debug output –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∞–Ω–∏—è

–û–±–Ω–∞—Ä—É–∂–µ–Ω infinite loop –≤ overlap handling

[–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è: docs/CHANGELOG.md]

–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 12.02.2026
–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: v16.21
–°–ª–µ–¥—É—é—â–∞—è –≤–µ—Ä—Å–∏—è: v16.22 (—É–ª—É—á—à–µ–Ω–Ω—ã–π clean_loops)