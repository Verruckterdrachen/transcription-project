# ✅ INTEGRATION-CHECKLIST.md — чеклист интеграции v16.x

Используется ПЕРЕД тем, как отправлять изменение в чат (AI → человек) и перед коммитом.

---

## 1. Общий принцип

Перед любым коммитом:

1. **Real test ОБЯЗАТЕЛЕН**  
   Запусти `python scripts/transcribe.py` на реальном интервью.

2. **Проверь 7 пунктов `VALIDATION.md`**  
   Коммитить можно только при 7/7 GREEN.

3. **Документация должна быть синхронизирована**  
   Если менялся пайплайн/архитектура/стратегия тестирования — обнови `docs/*`.

---

## 2. Чеклист интеграции (для AI/разработчика)

Перед тем как сказать «можно коммитить»:

### 2.1. Debugging / Root Cause

- [ ] Применена методология из `DEBUGGING.md`:
  - есть debug‑output;
  - выполнен 5 Whys;
  - найден и сформулирован ROOT CAUSE.
- [ ] Debug‑лог/вывод приложен (или описан) в обсуждении.

### 2.2. Debug checkpoints (новое v16.28)

- [ ] Для всех функций, которые модифицируют `seg["text"]` или `start/end`:
  - добавлен или используется `debug_checkpoint(..., stage_name=...)` **после** функции;
  - для критичных кейсов применены `target_timestamps` (при необходимости).
- [ ] В `process_audio_file()` есть checkpoint’ы на этапах:
  - AFTER ALIGNMENT
  - AFTER BOUNDARY CORRECTION
  - AFTER DEDUPLICATION
  - AFTER GAP FILLING (если были gaps)
  - AFTER TIMESTAMP CORRECTION
  - AFTER MERGE
  - AFTER TIMESTAMP INJECTION
  - AFTER CLASSIFICATION
  - AFTER SPLIT
  - AFTER TEXT CORRECTION
  - AFTER HALLUCINATION REMOVAL
  - AFTER AUTO-MERGE (если был)
  - BEFORE EXPORT (FINAL)

### 2.3. VERSION.md

- [ ] Обновлён `docs/VERSION.md`:
  - новая версия;
  - дата;
  - ROOT CAUSE (5 Whys);
  - краткое описание FIX;
  - при необходимости — уроки/изменения стратегии.

### 2.4. ARCHITECTURE.md

Если менялся пайплайн (новая функция, новый этап, изменение логики этапа):

- [ ] Обновлена таблица этапов:
  - добавлен/обновлён этап (номер/название);
  - указаны функция и файл;
  - проставлено, меняет ли `text`;
  - указан checkpoint, если нужно.
- [ ] При необходимости обновлена текстовая схема (data flow).

### 2.5. TESTING-STRATEGY.md

Если:

- добавлена новая утилита (regex, парсинг, форматирование);
- изменена логика существующей утилиты;
- добавлены/переосмыслены unit‑tests;

то:

- [ ] Обновлён `TESTING-STRATEGY.md`:
  - отражены новые правила для unit‑tests;
  - добавлены/обновлены примеры.

### 2.6. BUG-REPORT-TEMPLATE.md

Если баг показал новый тип ошибки/кейса:

- [ ] Шаблон бага дополнен/уточнён (при необходимости).
- [ ] Есть пример хорошего отчёта для такого типа багов.

---

## 3. VALDIATION.md — 7 обязательных проверок

Эти пункты должны быть явно проверены по итоговому TXT/JSON:

1. **Длинные блоки (>30s без inner timestamps)**  
   - нет длинных сегментов без внутренних отметок времени.

2. **Дубли timestamp**  
   - нет случаев вроде `00:00:56 00:00:56`.

3. **Заикания / повторения**  
   - нет артефактов типа «то есть то есть», «да да да».

4. **Ending hallucinations**  
   - нет фраз вида «Продолжение следует», «Подписывайтесь на канал» и т.п.

5. **Смежные реплики одного спикера**  
   - нет случаев, когда два соседних сегмента одного спикера должны быть слиты, но не слиты.

6. **Timestamp drift / назад по времени**  
   - время всегда идёт вперёд;
   - нет сдвигов типа `00:03:06 → 00:03:03`.

7. **Гапы (>3s)**  
   - нет необъяснимых пропусков в транскрипции (если в аудио есть речь).

---

## 4. Итоговый чеклист перед коммитом

Перед тем как сказать «коммить»:

- [ ] ROOT CAUSE найден и описан (5 Whys).
- [ ] DEBUG OUTPUT есть и понятен.
- [ ] Debug checkpoints стоят на всех text‑критичных этапах.
- [ ] `VERSION.md` обновлён.
- [ ] При необходимости обновлены `ARCHITECTURE.md`, `TESTING-STRATEGY.md`, `BUG-REPORT-TEMPLATE.md`.
- [ ] REAL TEST выполнен (`python scripts/transcribe.py`).
- [ ] 7 пунктов `VALIDATION.md` — GREEN.