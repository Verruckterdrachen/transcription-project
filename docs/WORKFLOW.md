# 🔄 Workflow взаимодействия

Подробное описание процесса работы AI Assistant с проектом через GitHub.

---

## 📋 Формат работы

### Основной принцип: **КОД В ЧАТЕ → КОММИТ В MAIN**

**AI (я):**
1. Читаю актуальный код из GitHub через MCP tools
2. Анализирую задачу и создаю решение
3. Присылаю готовые файлы в чат (полный код)
4. Проверяю изменения после коммита
5. Подтверждаю синхронизацию

**Разработчик (ты):**
1. Копируешь код из чата в локальные файлы
2. Выполняешь коммит напрямую в main
3. Уведомляешь: "Готово" или "Закоммитил vX.X"

---

## 🔍 ЭТАП 1: Аудит проекта (первый запрос)

### Когда делать аудит:
- ✅ При первом запросе в новой сессии
- ✅ После долгого перерыва (>1 день)
- ✅ Когда версия неизвестна
- ✅ Перед масштабными изменениями

### Процесс аудита:

```python
# 1. Читаю VERSION.md
mcp_tool_github-mcp-direct_get_file_contents(
    owner="Verruckterdrachen",
    repo="transcription-project",
    path="docs/VERSION.md"
)
# → Запоминаю текущую версию (например: v16.5)

# 2. Проверяю структуру scripts/
mcp_tool_github-mcp-direct_get_file_contents(
    owner="Verruckterdrachen",
    repo="transcription-project",
    path="scripts"
)

# 3. Читаю главный скрипт
mcp_tool_github-mcp-direct_get_file_contents(
    owner="Verruckterdrachen",
    repo="transcription-project",
    path="scripts/transcribe_v16.py"
)
# → Проверяю версию в комментариях

# 4. Проверяю все модули
for module in ["core", "corrections", "merge", "export"]:
    get_file_contents(f"scripts/{module}")

# 5. Проверяю тестовые данные
get_file_contents("test-results/latest")

# 6. Смотрю последние коммиты
list_commits(sha="main", perPage=10)

Формат отчёта после аудита:

🔍 АУДИТ ПРОЕКТА ЗАВЕРШЁН
═══════════════════════════════════════════════════════

✅ Версия проекта: v16.5 "Smart GAP Attribution"
✅ Дата последнего релиза: 10.02.2026

📊 Структура кода:
   📂 scripts/transcribe_v16.py (v16.5)
   📂 core/ - 5 модулей
      ├── config.py
      ├── utils.py
      ├── diarization.py
      ├── transcription.py
      └── alignment.py
   
   📂 corrections/ - 5 модулей
      ├── hallucinations.py
      ├── speaker_classifier.py
      ├── boundary_fixer.py
      ├── text_corrections.py
      └── journalist_commands.py
   
   📂 merge/ - 3 модуля
      ├── replica_merger.py
      ├── deduplicator.py
      └── validator.py
   
   📂 export/ - 2 модуля
      ├── json_export.py
      └── txt_export.py

📊 Последние тестовые данные:
   ✅ test-results/latest/ (4 файла)
   - журналист.json (152 реплики)
   - эксперт.json (89 реплик)
   - pipeline.log

📝 Последние 3 коммита:
   1. 10.02.2026: "🆕 v16.5: Smart GAP Attribution"
   2. 08.02.2026: "🔧 v16.4: Speaker protection"
   3. 05.02.2026: "⚡ v16.3: Performance boost"

✅ Несоответствий не обнаружено
✅ Готов к работе

Чем могу помочь?

🛠️ ЭТАП 2: Исправление/Добавление кода

Твой запрос (примеры):

Краткий:
"Исправь speaker_classifier.py - проблема с паузами"

Подробный:
"В speaker_classifier.py функция classify_speakers() 
неправильно определяет короткие реплики. Нужно добавить 
учёт пауз между сегментами. Порог паузы - 5s."

С контекстом:
"Смотри transcribe_v16.py строки 250-280. Там вызывается 
classify_speakers(). Она возвращает неправильные метки 
для реплик <5s. Исправь логику весовой системы."

Мои действия:

# 1. Читаю актуальный код
get_file_contents("scripts/corrections/speaker_classifier.py")

# 2. Анализирую проблему
# - Нахожу функцию classify_speakers()
# - Смотрю текущую логику
# - Проверяю зависимости

# 3. Читаю связанные файлы (если нужно)
get_file_contents("scripts/transcribe_v16.py")
get_file_contents("docs/MODULES.md")

Мой ответ:

✅ РЕШЕНИЕ ГОТОВО - ФАЙЛЫ ДЛЯ КОПИРОВАНИЯ
═══════════════════════════════════════════════════════════════════

📄 1. scripts/corrections/speaker_classifier.py
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Version: v16.6
# Last updated: 2026-02-11

# 🆕 v16.6: Added pause detection for speaker classification
# 🔧 v16.5: Smart GAP attribution

[ПОЛНЫЙ КОД ФАЙЛА - готов для копирования]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


📄 2. docs/VERSION.md
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Version: v16.6

## Последние изменения (v16.6 - 11.02.2026)
- 🔧 Улучшена классификация спикеров с учётом пауз >5s
- Добавлена функция detect_pause_transitions()
- Обновлена логика classify_speakers()

## Известные проблемы
[...]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


📄 3. docs/MODULES.md (обновлённый раздел)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
### speaker_classifier.py (v16.6)

**classify_speakers(segments, threshold=3.0)**
- Классифицирует спикеров с учётом длительности и пауз
- 🆕 v16.6: Добавлен анализ пауз между сегментами
[...]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


📋 GIT КОМАНДЫ (для коммита в main)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Скопируй файлы выше в соответствующие места
git add scripts/corrections/speaker_classifier.py docs/VERSION.md docs/MODULES.md
git commit -m "🔧 v16.6: Fix speaker classification with pause detection"
git push origin main

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ ЭТАП 3: Твой коммит

Твои действия:

# 1. Открой файлы в VSCode
code scripts/corrections/speaker_classifier.py
code docs/VERSION.md
code docs/MODULES.md

# 2. Скопируй содержимое из чата

# 3. Сохрани все файлы

# 4. Выполни коммит
git add scripts/corrections/speaker_classifier.py docs/VERSION.md docs/MODULES.md
git commit -m "🔧 v16.6: Fix speaker classification with pause detection"
git push origin main

# 5. Уведоми меня

Твоё сообщение мне:

"Готово"
или
"Закоммитил v16.6"
или
"Запушил в main"

🔍 ЭТАП 4: Проверка после коммита

Мои действия:

# Читаю обновлённые файлы
get_file_contents("docs/VERSION.md")
get_file_contents("scripts/corrections/speaker_classifier.py")

# Проверяю последние коммиты
list_commits(sha="main", perPage=3)

Мой ответ:

✅ СИНХРОНИЗАЦИЯ УСПЕШНА
═══════════════════════════════════════════════════════

🔍 Проверил GitHub:
   ✅ docs/VERSION.md → v16.6 (обновлено)
   ✅ speaker_classifier.py → v16.6 (обновлено)
   ✅ MODULES.md → обновлено (новая функция описана)

📝 Последний коммит:
   🔧 v16.6: Fix speaker classification with pause detection
   👤 @Verruckterdrachen
   📅 11.02.2026 12:05 MSK
   ⏱️ 2 минуты назад

📊 Текущее состояние проекта:
   - Версия: v16.6
   - Изменено файлов: 3
   - Строк добавлено: +45
   - Строк удалено: -12

✅ Готов к следующей задаче

📊 ЭТАП 5: Анализ тестовых данных

Когда анализировать:
После внесения изменений в код

Когда ты запустил транскрипцию и залил результаты

При обнаружении проблем в выходных данных

Твой запрос:

"Залил результаты теста в test-results/latest/"
или
"Проанализируй результаты последнего теста"
или
"Смотри test-results/latest/журналист.json - там проблемы"

Мои действия:

# 1. Читаю структуру test-results/latest/
get_file_contents("test-results/latest")

# 2. Читаю файлы результатов
get_file_contents("test-results/latest/журналист.json")
get_file_contents("test-results/latest/эксперт.json")
get_file_contents("test-results/latest/pipeline.log")

# 3. Анализирую данные
# - Проверяю атрибуцию спикеров
# - Ищу ошибки в логах
# - Сравниваю с предыдущими версиями (если есть)

Мой ответ:

🔍 АНАЛИЗ ТЕСТОВЫХ ДАННЫХ (v16.6)
═══════════════════════════════════════════════════════

📊 Файлы проанализированы:
   ✅ журналист.json (152 реплики, 45:32 мин)
   ✅ эксперт.json (89 реплик, 68:15 мин)
   ✅ pipeline.log (проверен на ошибки)

📈 Статистика спикеров:
   Журналист: 152 реплики (40% времени)
   Эксперт: 89 реплик (60% времени)
   Средняя длительность реплики:
     - Журналист: 5.2s
     - Эксперт: 18.7s

⚠️ НАЙДЕННЫЕ ПРОБЛЕМЫ:

1. **Неверная атрибуция (3 случая)**
   - Строка 45: "Ну да" → атрибутировано Эксперту (должно быть Журналист)
   - Строка 78: "Понятно" → атрибутировано Журналисту (должно быть Эксперт)
   - Строка 134: "Давайте продолжим" → проблема с паузой

2. **Длинные паузы (2 предупреждения)**
   - 00:15:32 - 00:15:47 (15s gap) - пропущен контекст
   - 00:42:18 - 00:42:30 (12s gap) - обработано некорректно

3. **Pipeline warnings (2)**
   - Empty segment at 00:08:15
   - Low confidence (<0.5) at 00:23:40

💡 РЕКОМЕНДАЦИИ:

1. **Улучшить detect_pause_transitions()**
   - Снизить threshold с 5s до 3s для коротких подтверждений
   - Добавить whitelist для фраз типа "Ну да", "Понятно"

2. **Обработка длинных пауз**
   - Добавить специальную логику для gaps >10s
   - Использовать контекст предыдущих 2-3 реплик

3. **Валидация confidence**
   - Добавить проверку confidence < 0.5
   - Отмечать такие сегменты для ручной проверки

📋 Следующие шаги:
1. Исправить логику в speaker_classifier.py (threshold 3s)
2. Добавить whitelist коротких подтверждений
3. Улучшить обработку gaps в transcription.py

Исправляем эти проблемы?

📦 Какие файлы я присылаю

ОБЯЗАТЕЛЬНО (при каждом изменении):
✅ Изменённый код (полный файл, готовый для копирования)

✅ docs/VERSION.md (ВСЕГДА обновляю версию!)

ОПЦИОНАЛЬНО (по необходимости):
⚠️ docs/MODULES.md - если:

Добавлена новая функция

Изменилась сигнатура функции

Изменилось поведение (новые параметры, return types)

⚠️ docs/ARCHITECTURE.md - если:

Добавлен новый этап в pipeline

Изменён порядок обработки

Добавлен новый модуль в структуру

⚠️ docs/CHANGELOG.md - если:

Major update (v16.x → v17.0)

Breaking changes

Значительный bug fix

⏱️ Примерное время цикла

| Этап             | Время   | Описание                    |
| ---------------- | ------- | --------------------------- |
| Аудит проекта    | 30-60s  | При первом запросе          |
| Чтение кода      | 10-15s  | 1-3 файла                   |
| Анализ + решение | 30-60s  | Создание кода               |
| Ответ в чат      | 5-10s   | Форматирование              |
| Твой коммит      | 2-5 мин | Копирование + git           |
| Проверка         | 10-15s  | Чтение GitHub               |
| ИТОГО:           | 3-7 мин | От запроса до синхронизации |

🎯 Оптимизация workflow
Когда я НЕ делаю полный аудит:
Работаем в одной сессии

Версия не изменилась

Контекст сохранён

Пример:

Ты: "Исправь X"
Я: [аудит] + решение

Ты: "Готово"
Я: [проверка] + подтверждение

Ты: "Теперь исправь Y"
Я: [БЕЗ аудита] + решение  ← быстрее!

Когда присылаю diff вместо полного файла:
Если изменение точечное (1-5 строк):

📝 ИЗМЕНЕНИЕ (diff)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 scripts/corrections/speaker_classifier.py
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Строка 156:
- return merged_segments
+ return merged_segments if merged_segments else []

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Хочешь полный файл или diff достаточно?

Ты выбираешь:

"Diff достаточно" - быстрее

"Дай полный файл" - безопаснее

❓ FAQ
Q: Что если я забуду обновить VERSION.md?
A: При следующем запросе я прочитаю GitHub и напомню:

⚠️ ВНИМАНИЕ: Обнаружено несоответствие версий
   speaker_classifier.py: v16.6 (в комментариях)
   VERSION.md: v16.5

Обнови VERSION.md перед продолжением работы!

Q: Можно ли коммитить несколько файлов одновременно?
A: Да! Я присылаю все изменённые файлы одним блоком:

✅ РЕШЕНИЕ: 4 файла для копирования
━━━ 1. speaker_classifier.py ━━━
━━━ 2. boundary_fixer.py ━━━
━━━ 3. docs/VERSION.md ━━━
━━━ 4. docs/MODULES.md ━━━

Q: Как часто нужно делать аудит?
A: Только при первом запросе в сессии или после долгого перерыва.

Q: Что если я закоммитил не все файлы?
A: Я увижу это при проверке и напомню:

⚠️ Не все файлы закоммичены:
   ✅ speaker_classifier.py
   ❌ docs/VERSION.md (не обновлён)
   ❌ docs/MODULES.md (не обновлён)