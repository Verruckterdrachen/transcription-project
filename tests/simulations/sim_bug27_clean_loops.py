"""
tests/simulations/sim_bug27_clean_loops.py
Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ‘ĞĞ“ #27: clean_loops Ğ»Ğ¾Ğ¶Ğ½Ğ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ»Ğ¾Ğ² Ñ low-meaningful N-Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ğ¼Ğ¸

ROOT CAUSE: N-Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° "Ğ±Ñ‹Ğ». Ğ˜ Ğ²Ğ¾Ñ‚" (0 Ğ·Ğ½Ğ°Ğ¼ĞµĞ½Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… ÑĞ»Ğ¾Ğ²) Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°Ğ»Ğ° Ğ² seen[],
Ğ´Ğ°Ğ²Ğ°Ğ»Ğ° fuzzy sim=0.80 Ñ ÑĞºĞ¾Ñ€ĞµĞ¼ "Ğ±Ñ‹Ğ»Ğ¾. Ğ¸, Ğ²" â†’ Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ loop â†’ ÑƒĞ´Ğ°Ğ»ÑĞ»Ğ¾ÑÑŒ "Ğ±Ñ‹Ğ»."

FIX v17.9: _count_meaningful(phrase) < MIN_MEANINGFUL_WORDS=2
â†’ N-Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² output, Ğ½Ğ¾ Ğ² seen[] ĞĞ• Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼.

Ğ—Ğ°Ğ¿ÑƒÑĞº: python tests/simulations/sim_bug27_clean_loops.py
ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ: OLD â†’ RED (Ñ‚ĞµĞºÑÑ‚ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ½), NEW â†’ GREEN (Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½)
"""

from difflib import SequenceMatcher
import re
import sys

# â”€â”€â”€ ĞšĞĞĞ¡Ğ¢ĞĞĞ¢Ğ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

RUSSIAN_STOP_WORDS = {
    'Ğ±Ñ‹Ğ»', 'Ğ±Ñ‹Ğ»Ğ°', 'Ğ±Ñ‹Ğ»Ğ¾', 'Ğ±Ñ‹Ğ»Ğ¸', 'Ğ±ÑƒĞ´Ñƒ', 'Ğ±ÑƒĞ´ĞµÑ‚',
    'Ğ±ÑƒĞ´ÑƒÑ‚', 'Ğ±ÑƒĞ´ĞµĞ¼', 'Ğ±ÑƒĞ´ĞµÑ‚Ğµ', 'Ğ±Ñ‹Ğ²Ğ°ĞµÑ‚', 'ĞµÑÑ‚ÑŒ', 'Ğ±Ñ‹Ñ‚ÑŒ',
    'Ğ²', 'Ğ²Ğ¾', 'Ğ½Ğ°', 'Ñ', 'ÑĞ¾', 'Ğº', 'ĞºĞ¾', 'Ğ¿Ğ¾', 'Ğ¸Ğ·',
    'Ğ·Ğ°', 'Ğ´Ğ¾', 'Ğ¿Ñ€Ğ¸', 'Ñ‡ĞµÑ€ĞµĞ·', 'Ğ¾Ğ±', 'Ğ¾', 'Ñƒ', 'Ğ´Ğ»Ñ',
    'Ğ¾Ñ‚', 'Ğ¿Ğ¾Ğ´', 'Ğ½Ğ°Ğ´', 'Ğ¿Ñ€Ğ¾', 'Ğ±ĞµĞ·', 'Ğ¼ĞµĞ¶Ğ´Ñƒ', 'ÑÑ€ĞµĞ´Ğ¸',
    'Ğ¸', 'Ğ°', 'Ğ½Ğ¾', 'Ğ¸Ğ»Ğ¸', 'Ñ‡Ñ‚Ğ¾', 'ĞºĞ°Ğº', 'ĞµÑĞ»Ğ¸', 'ĞºĞ¾Ğ³Ğ´Ğ°',
    'Ğ³Ğ´Ğµ', 'Ñ‡Ñ‚Ğ¾Ğ±Ñ‹', 'Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ', 'Ñ‚Ğ¾Ğ¶Ğµ', 'Ñ‚Ğ°ĞºĞ¶Ğµ', 'Ğ»Ğ¸Ğ±Ğ¾',
    'Ğ½Ğ¸', 'Ñ…Ğ¾Ñ‚Ñ', 'Ğ·Ğ°Ñ‚Ğ¾', 'Ğ¾Ğ´Ğ½Ğ°ĞºĞ¾',
    'Ğ²Ğ¾Ñ‚', 'Ğ¶Ğµ', 'Ğ»Ğ¸', 'Ğ±Ñ‹', 'Ğ½Ñƒ', 'Ğ½Ğµ', 'Ğ´Ğ°', 'Ñ‚Ğ¾', 'Ñ‚Ğ°Ğº',
    'Ğ»Ğ¸ÑˆÑŒ', 'Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾', 'Ğ´Ğ°Ğ¶Ğµ', 'ÑƒĞ¶',
    'Ñ', 'Ñ‚Ñ‹', 'Ğ¾Ğ½', 'Ğ¾Ğ½Ğ°', 'Ğ¾Ğ½Ğ¾', 'Ğ¼Ñ‹', 'Ğ²Ñ‹', 'Ğ¾Ğ½Ğ¸',
    'Ğ¼ĞµĞ½Ñ', 'Ñ‚ĞµĞ±Ñ', 'ĞµĞ³Ğ¾', 'ĞµÑ‘', 'ĞµĞµ', 'Ğ½Ğ°Ñ', 'Ğ²Ğ°Ñ', 'Ğ¸Ñ…',
    'Ğ¼Ğ½Ğµ', 'Ñ‚ĞµĞ±Ğµ', 'ĞµĞ¼Ñƒ', 'ĞµĞ¹', 'Ğ½Ğ°Ğ¼', 'Ğ²Ğ°Ğ¼', 'Ğ¸Ğ¼',
    'ÑÑ‚Ğ¾', 'ÑÑ‚Ğ¾Ñ‚', 'ÑÑ‚Ğ°', 'ÑÑ‚Ğ¸',
    'Ñ‚Ğ°Ğ¼', 'Ñ‚ÑƒÑ‚', 'Ğ·Ğ´ĞµÑÑŒ', 'Ñ‚Ğ¾Ğ³Ğ´Ğ°', 'ÑƒĞ¶Ğµ', 'ĞµÑ‰Ğµ', 'ĞµÑ‰Ñ‘',
    'Ğ¾Ñ‡ĞµĞ½ÑŒ', 'ÑĞ¾Ğ²ÑĞµĞ¼', 'Ğ²ĞµÑÑŒĞ¼Ğ°',
}
MIN_MEANINGFUL_WORDS = 2
LOOP_WINDOW = 30


def _count_meaningful(phrase: str) -> int:
    clean = re.sub(r'[.,!?;:Â«Â»"\'"()\[\]]', '', phrase.lower())
    words = clean.split()
    return sum(1 for w in words if w not in RUSSIAN_STOP_WORDS)


# â”€â”€â”€ OLD Ğ²ĞµÑ€ÑĞ¸Ñ (Ğ´Ğ¾ v17.9, Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ‘ĞĞ“ #27) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def clean_loops_OLD(text):
    """v16.22â€“v17.8: Ğ±ĞµĞ· Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ±ĞµÑÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… N-Ğ³Ñ€Ğ°Ğ¼Ğ¼."""
    words = text.split()
    seen = []
    cleaned = []
    i = 0

    while i < len(words):
        phrase = ' '.join(words[i:i+3])
        phrase_lower = phrase.lower()

        is_loop = False
        for prev_phrase in seen:
            similarity = SequenceMatcher(None, phrase_lower, prev_phrase).ratio()
            if similarity >= 0.75:
                is_loop = True
                break

        if is_loop:
            i += 1
            continue

        seen.append(phrase_lower)
        if len(seen) > LOOP_WINDOW:
            seen.pop(0)

        cleaned.extend(words[i:i+3])
        i += 3

    final = ' '.join(cleaned)
    final = re.sub(r'([.,!?])\1{2,}', r'\1', final)
    return final.strip()


# â”€â”€â”€ NEW Ğ²ĞµÑ€ÑĞ¸Ñ (v17.9, Ñ„Ğ¸ĞºÑ Ğ‘ĞĞ“ #27) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def clean_loops_NEW(text):
    """v17.9: N-Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ñ < MIN_MEANINGFUL_WORDS Ğ² seen[] Ğ½Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼."""
    words = text.split()
    seen = []
    cleaned = []
    i = 0

    while i < len(words):
        phrase = ' '.join(words[i:i+3])
        phrase_lower = phrase.lower()

        # FIX v17.9: Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ±ĞµÑÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ N-Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
        if _count_meaningful(phrase_lower) < MIN_MEANINGFUL_WORDS:
            cleaned.extend(words[i:i+3])
            i += 3
            continue

        is_loop = False
        for prev_phrase in seen:
            similarity = SequenceMatcher(None, phrase_lower, prev_phrase).ratio()
            if similarity >= 0.75:
                is_loop = True
                break

        if is_loop:
            i += 1
            continue

        seen.append(phrase_lower)
        if len(seen) > LOOP_WINDOW:
            seen.pop(0)

        cleaned.extend(words[i:i+3])
        i += 3

    final = ' '.join(cleaned)
    final = re.sub(r'([.,!?])\1{2,}', r'\1', final)
    return final.strip()


# â”€â”€â”€ TEST CASES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

TEST_CASES = [
    {
        "id": "TC-01",
        "desc": "ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞµĞ¹Ñ Ğ‘ĞĞ“ #27: 'Ğ±Ñ‹Ğ».' ÑƒĞ´Ğ°Ğ»ÑĞ»Ğ¾ÑÑŒ Ğ¸Ğ· 'Ğ½Ğµ Ğ±Ñ‹Ğ». Ğ˜ Ğ²Ğ¾Ñ‚ Ğ½ĞµĞ¼Ñ†Ñ‹'",
        "input": (
            "Ğ½ĞµĞ¼ĞµÑ†ĞºĞ°Ñ Ğ°Ñ€Ñ‚Ğ¸Ğ»Ğ»ĞµÑ€Ğ¸Ñ Ğ¼Ğ¾Ğ³Ğ»Ğ° Ğ±Ğ¸Ñ‚ÑŒ Ğ²Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ¸ Ğ²Ğ»ĞµĞ²Ğ¾ Ğ²Ğ´Ğ¾Ğ»ÑŒ Ğ±ĞµÑ€ĞµĞ³Ğ°. "
            "Ğ¢Ğ°Ğ¼ Ğ±Ñ‹Ğ»Ğ¾. Ğ¸, Ğ² Ğ¾Ğ±Ñ‰ĞµĞ¼-Ñ‚Ğ¾, Ğ½ĞµĞ¼ĞµÑ†ĞºĞ°Ñ Ğ°Ñ€Ñ‚Ğ¸Ğ»Ğ»ĞµÑ€Ğ¸Ñ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ° Ñ‚Ğ°Ğº Ğ´Ğ°Ğ»ĞµĞºĞ¾. "
            "Ğ–ÑƒĞºĞ¾Ğ² Ğ½Ğµ Ğ±Ñ‹Ğ». Ğ˜ Ğ²Ğ¾Ñ‚ Ğ½ĞµĞ¼Ñ†Ñ‹"
        ),
        "must_contain": "Ğ–ÑƒĞºĞ¾Ğ² Ğ½Ğµ Ğ±Ñ‹Ğ».",
        "must_not_contain": None,
    },
    {
        "id": "TC-02",
        "desc": "Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ loop-Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒÑÑ (regression)",
        "input": (
            "ÑÑ‚Ğ¾ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ ÑÑ‚Ğ¾ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ ÑÑ‚Ğ¾ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ "
            "Ğ² Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ²Ğ¾Ğ¹Ğ½Ñ‹"
        ),
        "must_contain": "ÑÑ‚Ğ¾ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚",
        "must_not_contain": None,
        # NEW Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° ÑĞ¾ĞºÑ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ñ‹, Ğ½Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ¾Ğ´Ğ½Ğ¾ Ğ²Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ
    },
    {
        "id": "TC-03",
        "desc": "Ğ¤Ğ¾Ñ€Ğ¼Ñ‹ 'Ğ±Ñ‹Ñ‚ÑŒ' Ğ² Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°Ñ… Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑÑ‚ÑÑ",
        "input": (
            "ÑÑ‚Ğ¾ Ğ±Ñ‹Ğ»Ğ¾ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¾ Ñ€ĞµÑˆĞµĞ½Ğ¸ĞµĞ¼ ÑÑ‚Ğ°Ğ²ĞºĞ¸. "
            "Ğ˜ Ğ²Ğ¾Ñ‚ Ğ±Ñ‹Ğ»Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ½Ğ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ, ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾ Ğ²ÑÑ‘ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾Ğµ. "
            "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ±Ñ‹Ğ». Ğ˜ Ğ²Ğ¾Ñ‚ Ğ½ĞµĞ¼Ñ†Ñ‹ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¸Ğ»Ğ¸."
        ),
        "must_contain": "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ±Ñ‹Ğ».",
        "must_not_contain": None,
    },
    {
        "id": "TC-04",
        "desc": "Ğ¡Ğ¾ÑĞ·Ñ‹ Ğ¸ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ†Ñ‹ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğµ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ğ° Ğ½Ğµ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… ÑĞºĞ¾Ñ€ĞµĞ¹",
        "input": (
            "Ğ¸ Ğ²Ğ¾Ñ‚ Ğ¸ Ğ²Ğ¾Ñ‚ Ğ¸ Ğ²Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ»Ğ¸ Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ğµ. "
            "ĞĞµĞ¼ĞµÑ†ĞºĞ°Ñ Ğ°Ñ€Ñ‚Ğ¸Ğ»Ğ»ĞµÑ€Ğ¸Ñ Ğ±Ñ‹Ğ»Ğ° ÑĞ¾ÑÑ€ĞµĞ´Ğ¾Ñ‚Ğ¾Ñ‡ĞµĞ½Ğ°."
        ),
        "must_contain": "Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ»Ğ¸ Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ğµ",
        "must_not_contain": None,
    },
    {
        "id": "TC-05",
        "desc": "Ğ¢ĞµĞºÑÑ‚ Ğ±ĞµĞ· loop-Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ğ² Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹",
        "input": (
            "Ğ¿Ñ€Ğ¾Ñ€Ñ‹Ğ² Ğ±Ğ»Ğ¾ĞºĞ°Ğ´Ñ‹ Ğ±Ñ‹Ğ» Ğ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ»Ñ‘Ğ½ Ğ² ÑĞ½Ğ²Ğ°Ñ€Ğµ 1943 Ğ³Ğ¾Ğ´Ğ°. "
            "Ğ’Ğ¾Ğ¹ÑĞºĞ° Ğ›ĞµĞ½Ğ¸Ğ½Ğ³Ñ€Ğ°Ğ´ÑĞºĞ¾Ğ³Ğ¾ Ğ¸ Ğ’Ğ¾Ğ»Ñ…Ğ¾Ğ²ÑĞºĞ¾Ğ³Ğ¾ Ñ„Ñ€Ğ¾Ğ½Ñ‚Ğ¾Ğ² ÑĞ¾ĞµĞ´Ğ¸Ğ½Ğ¸Ğ»Ğ¸ÑÑŒ."
        ),
        "must_contain": "Ğ¿Ñ€Ğ¾Ñ€Ñ‹Ğ² Ğ±Ğ»Ğ¾ĞºĞ°Ğ´Ñ‹ Ğ±Ñ‹Ğ» Ğ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ»Ñ‘Ğ½",
        "must_not_contain": None,
    },
]


# â”€â”€â”€ RUNNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def run():
    print("=" * 65)
    print("  sim_bug27_clean_loops.py â€” Ğ‘ĞĞ“ #27 regression simulation")
    print("=" * 65)

    old_results = []
    new_results = []

    for tc in TEST_CASES:
        out_old = clean_loops_OLD(tc["input"])
        out_new = clean_loops_NEW(tc["input"])

        old_pass = True
        new_pass = True

        if tc["must_contain"] and tc["must_contain"] not in out_old:
            old_pass = False
        if tc["must_not_contain"] and tc["must_not_contain"] in out_old:
            old_pass = False

        if tc["must_contain"] and tc["must_contain"] not in out_new:
            new_pass = False
        if tc["must_not_contain"] and tc["must_not_contain"] in out_new:
            new_pass = False

        old_results.append(old_pass)
        new_results.append(new_pass)

        old_icon = "âœ…" if old_pass else "âŒ"
        new_icon = "âœ…" if new_pass else "âŒ"

        print(f"\n[{tc['id']}] {tc['desc']}")
        print(f"  OLD: {old_icon}  |  NEW: {new_icon}")
        if not new_pass:
            print(f"  âš ï¸  ĞĞ¶Ğ¸Ğ´Ğ°Ğ»Ğ¾ÑÑŒ: '{tc['must_contain']}'")
            print(f"  âš ï¸  ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾:  '{out_new[:120]}'")

    # â”€â”€â”€ Ğ˜Ğ¢ĞĞ“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("\n" + "=" * 65)
    old_score = sum(old_results)
    new_score = sum(new_results)
    total = len(TEST_CASES)

    print(f"  OLD (Ğ´Ğ¾ v17.9):  {old_score}/{total}  {'ğŸŸ¢ GREEN' if old_score == total else 'ğŸ”´ RED'}")
    print(f"  NEW (v17.9 FIX): {new_score}/{total}  {'ğŸŸ¢ GREEN' if new_score == total else 'ğŸ”´ RED'}")
    print("=" * 65)

    # TC-01 Ğ² OLD Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ RED (Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ±Ğ°Ğ³)
    if old_results[0]:
        print("\nâš ï¸  Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•: OLD Ğ¿Ñ€Ğ¾ÑˆÑ‘Ğ» TC-01 â€” Ğ±Ğ°Ğ³ Ğ½Ğµ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ÑÑ!")
        print("   ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ñ€Ğ¾Ğ³ sim Ğ² OLD Ğ²ĞµÑ€ÑĞ¸Ğ¸.")

    if new_score == total:
        print("\nâœ… SIMULATION GREEN â€” Ñ„Ğ¸ĞºÑ v17.9 Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾.")
        sys.exit(0)
    else:
        print("\nâŒ SIMULATION RED â€” Ñ„Ğ¸ĞºÑ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½!")
        sys.exit(1)


if __name__ == "__main__":
    run()
